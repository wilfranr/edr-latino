<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Tu compañero definitivo para Elden Ring. Guía completa con jefes, armas, objetos, ubicaciones y misiones en español latino.">
    <meta name="keywords" content="Elden Ring, guía, jefes, armas, objetos, misiones, español, latino">
    <meta name="author" content="ER Asistente">
    <meta name="theme-color" content="#f59e0b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ER Companion">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://wilfranr.github.io/edr-latino/">
    <meta property="og:title" content="ER Asistente - Guía Completa">
    <meta property="og:description" content="Tu compañero definitivo para Elden Ring. Guía completa con jefes, armas, objetos, ubicaciones y misiones en español latino.">
    <meta property="og:image" content="https://wilfranr.github.io/edr-latino/icons/icon-512x512.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://wilfranr.github.io/edr-latino/">
    <meta property="twitter:title" content="ER Asistente - Guía Completa">
    <meta property="twitter:description" content="Tu compañero definitivo para Elden Ring. Guía completa con jefes, armas, objetos, ubicaciones y misiones en español latino.">
    <meta property="twitter:image" content="https://wilfranr.github.io/edr-latino/icons/icon-512x512.png">
    
    <title>ER Asistente - Guía Completa</title>
    
    <!-- PWA Links -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Estilos personalizados Glassmorphism 2.0 -->
    <style>
        /* Variables CSS para Glassmorphism 2.0 */
        :root {
            --glass-bg-primary: #0a0a0f;
            --glass-bg-secondary: #1a1a2e;
            --glass-bg-tertiary: #16213e;
            --glass-accent-amber: #ffd700;
            --glass-accent-emerald: #00ff88;
            --glass-accent-purple: #8b5cf6;
            --glass-accent-blue: #3b82f6;
            --glass-text-primary: #ffffff;
            --glass-text-secondary: #e2e8f0;
            --glass-text-muted: #94a3b8;
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --glass-shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.4);
            --glass-blur: 16px;
            --glass-radius: 16px;
            --glass-radius-small: 12px;
        }

        /* Fondo dinámico con gradientes Aurora */
        body {
            font-family: 'Inter', sans-serif;
            background: var(--glass-bg-primary);
            color: var(--glass-text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Fondo dinámico animado */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 136, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 60% 40%, rgba(255, 215, 0, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 25%, #16213e 50%, #1a1a2e 75%, #0a0a0f 100%);
            animation: auroraFlow 20s ease-in-out infinite;
            z-index: -2;
        }

        /* Animación del fondo Aurora */
        @keyframes auroraFlow {
            0%, 100% {
                transform: translateX(0) translateY(0) scale(1);
                filter: hue-rotate(0deg);
            }
            25% {
                transform: translateX(-2%) translateY(-1%) scale(1.02);
                filter: hue-rotate(10deg);
            }
            50% {
                transform: translateX(1%) translateY(-2%) scale(0.98);
                filter: hue-rotate(-5deg);
            }
            75% {
                transform: translateX(-1%) translateY(1%) scale(1.01);
                filter: hue-rotate(5deg);
            }
        }

        /* Efecto parallax para el fondo */
        .parallax-bg {
            transform: translateZ(-1px) scale(1.1);
            will-change: transform;
        }

        .font-cinzel {
            font-family: 'Cinzel', serif;
        }

        .font-orbitron {
            font-family: 'Orbitron', monospace;
        }

        /* Clases base para elementos de cristal */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius);
            box-shadow: var(--glass-shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0.6;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--glass-shadow-hover);
            background: rgba(255, 255, 255, 0.08);
        }

        .glass-card:active {
            transform: translateY(-2px) scale(0.98);
            backdrop-filter: blur(calc(var(--glass-blur) + 4px));
            -webkit-backdrop-filter: blur(calc(var(--glass-blur) + 4px));
            transition: all 0.1s ease;
        }

        .glass-button {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius-small);
            box-shadow: var(--glass-shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .glass-button:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: var(--glass-shadow-hover);
        }

        .glass-button:active {
            transform: translateY(1px) scale(0.95);
            backdrop-filter: blur(calc(var(--glass-blur) + 2px));
            -webkit-backdrop-filter: blur(calc(var(--glass-blur) + 2px));
            transition: all 0.1s ease;
        }

        .glass-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: rgba(255, 255, 255, 0.02);
            transform: none;
            box-shadow: var(--glass-shadow);
        }

        .glass-progress {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius-small);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
        }

        .glass-progress-bar {
            background: linear-gradient(135deg, var(--glass-accent-amber), var(--glass-accent-emerald));
            border-radius: var(--glass-radius-small);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .glass-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius);
            box-shadow: var(--glass-shadow);
            border: none;
        }

        .glass-nav-button {
            background: transparent;
            border: none;
            border-radius: var(--glass-radius-small);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .glass-nav-button.active {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(calc(var(--glass-blur) + 4px));
            -webkit-backdrop-filter: blur(calc(var(--glass-blur) + 4px));
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .glass-nav-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.08);
        }

        .glass-nav-button:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.15);
        }

        /* Animaciones de entrada */
        @keyframes glassSlideIn {
            0% {
                transform: translateY(30px) scale(0.9);
                opacity: 0;
                backdrop-filter: blur(0px);
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
                backdrop-filter: blur(var(--glass-blur));
            }
        }

        @keyframes glassFadeIn {
            0% {
                opacity: 0;
                transform: scale(0.95);
                backdrop-filter: blur(0px);
            }
            100% {
                opacity: 1;
                transform: scale(1);
                backdrop-filter: blur(var(--glass-blur));
            }
        }

        @keyframes glassPress {
            0% {
                transform: scale(1);
                backdrop-filter: blur(var(--glass-blur));
            }
            50% {
                transform: scale(0.95);
                backdrop-filter: blur(calc(var(--glass-blur) + 4px));
            }
            100% {
                transform: scale(1);
                backdrop-filter: blur(var(--glass-blur));
            }
        }

        .glass-slide-in {
            animation: glassSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-fade-in {
            animation: glassFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-press {
            animation: glassPress 0.2s ease-in-out;
        }

        /* Efecto de pulso para feedback */
        @keyframes glassPulse {
            0% {
                box-shadow: var(--glass-shadow);
            }
            50% {
                box-shadow: var(--glass-shadow-hover), 0 0 20px rgba(255, 215, 0, 0.3);
            }
            100% {
                box-shadow: var(--glass-shadow);
            }
        }

        .glass-pulse {
            animation: glassPulse 0.3s ease-in-out;
        }

        /* Checkboxes de cristal */
        .glass-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .glass-checkbox:checked {
            background: linear-gradient(135deg, var(--glass-accent-amber), var(--glass-accent-emerald));
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .glass-checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 12px;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        /* Checkboxes de cristal - Ocultos para usar swipe */
        .glass-checkbox {
            display: none;
        }

        /* Indicador de swipe - Eliminado */

        /* Borde brillante para tarjeta completada */
        .swipe-container.completed {
            border: 2px solid var(--glass-accent-emerald);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.6), inset 0 0 10px rgba(16, 185, 129, 0.1);
            animation: completedPulse 2s ease-in-out infinite;
        }

        @keyframes completedPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(16, 185, 129, 0.6), inset 0 0 10px rgba(16, 185, 129, 0.1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.8), inset 0 0 15px rgba(16, 185, 129, 0.2);
            }
        }

        /* Contenedor de swipe */
        .swipe-container {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        /* Efecto de swipe */
        .swipe-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.2));
            backdrop-filter: blur(5px);
            border: 1px solid rgba(16, 185, 129, 0.3);
            transform: translateX(-100%);
            transition: transform 0.3s ease, background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--glass-accent-emerald);
            font-weight: bold;
            font-size: 14px;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        /* Overlay para desmarcar (rojo) */
        .swipe-overlay.unmark {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.2));
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .swipe-overlay.show {
            transform: translateX(0);
        }

        /* Animación de completado */
        .swipe-completed {
            animation: swipeComplete 0.6s ease;
        }

        @keyframes swipeComplete {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Indicador de ayuda para swipe */
        .swipe-hint {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.3);
            font-size: 12px;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .swipe-container:hover .swipe-hint {
            opacity: 0.7;
        }

        /* Animación de pulso eliminada - ya no hay indicadores */

        /* Títulos expresivos */
        .glass-title {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            background: linear-gradient(135deg, var(--glass-accent-amber), var(--glass-accent-emerald));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            :root {
                --glass-blur: 12px;
                --glass-radius: 12px;
                --glass-radius-small: 8px;
            }
        }

        /* Barra superior fija */
        #top-navigation {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border-bottom: 1px solid var(--glass-border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        .top-nav-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .top-nav-logo {
            display: flex;
            align-items: center;
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--glass-accent-amber);
            text-decoration: none;
        }

        .top-nav-logo svg {
            width: 32px;
            height: 32px;
            margin-right: 8px;
        }

        .top-nav-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .top-nav-button {
            background: transparent;
            border: none;
            color: var(--glass-text-secondary);
            padding: 8px;
            border-radius: var(--glass-radius-small);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .top-nav-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--glass-accent-amber);
            transform: translateY(-1px);
        }

        .top-nav-button svg {
            width: 20px;
            height: 20px;
        }

        /* Menú desplegable */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 16px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius);
            box-shadow: var(--glass-shadow);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: var(--glass-text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--glass-accent-amber);
        }

        .dropdown-item svg {
            width: 18px;
            height: 18px;
            margin-right: 12px;
        }

        /* Búsqueda expandida en barra superior */
        .search-expanded {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border-bottom: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            padding: 16px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .search-expanded.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .search-expanded input {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: block;
        }

        #top-search-results {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 12px;
        }

        #top-search-results .glass-card {
            margin-bottom: 8px;
        }

        #top-search-results .glass-card:last-child {
            margin-bottom: 0;
        }

        /* Ajustar el contenido principal para la barra superior */
        .main-content {
            margin-top: 80px; /* Espacio para la barra superior */
        }

        /* Navegación inferior fija */
        #bottom-navigation {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border-top: 1px solid var(--glass-border);
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.3);
        }

        .bottom-nav-button {
            background: transparent;
            border: none;
            border-radius: var(--glass-radius-small);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            min-width: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        .bottom-nav-button.active {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(calc(var(--glass-blur) + 4px));
            -webkit-backdrop-filter: blur(calc(var(--glass-blur) + 4px));
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .bottom-nav-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .bottom-nav-button:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.15);
        }

        /* Ajustar el contenido principal para la navegación inferior */
        .container {
            padding-bottom: 60px; /* Espacio mínimo para la navegación inferior */
        }

        /* Animaciones para las tabs de equipamiento y objetos */
        .equipment-content,
        .items-content {
            transition: all 0.3s ease-in-out;
        }

        .equipment-tab-button,
        .items-tab-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Responsive para barra superior */
        @media (max-width: 768px) {
            .top-nav-container {
                padding: 8px 12px;
            }
            
            .top-nav-logo {
                font-size: 1.25rem;
            }
            
            .top-nav-logo svg {
                width: 28px;
                height: 28px;
            }
            
            .top-nav-button {
                padding: 6px;
            }
            
            .top-nav-button svg {
                width: 18px;
                height: 18px;
            }
            
            .dropdown-menu {
                right: 8px;
                min-width: 180px;
            }
            
            .search-expanded {
                padding: 12px;
            }
        }

        @media (max-width: 480px) {
            .top-nav-logo {
                font-size: 1.1rem;
            }
            
            .top-nav-logo svg {
                width: 24px;
                height: 24px;
                margin-right: 6px;
            }
            
            .top-nav-actions {
                gap: 8px;
            }
            
            .dropdown-menu {
                right: 4px;
                min-width: 160px;
            }
            
            .dropdown-item {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .dropdown-item svg {
                width: 16px;
                height: 16px;
                margin-right: 10px;
            }
        }

        /* Responsive para navegación inferior */
        @media (max-width: 640px) {
            #bottom-navigation {
                padding: 4px;
            }
            
            .bottom-nav-button {
                min-width: 50px;
                padding: 4px 2px;
                justify-content: flex-end;
            }
            
            .bottom-nav-button svg {
                height: 18px;
                width: 18px;
            }
            
            .bottom-nav-button span {
                font-size: 9px;
            }
            
            /* Reducir aún más el espacio en móviles */
            .container {
                padding-bottom: 50px !important;
            }
        }

        /* Responsive para tabs de equipamiento */
        @media (max-width: 768px) {
            .equipment-tab-button {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            .equipment-tab-button span {
                font-size: 10px;
            }
        }

        @media (max-width: 640px) {
            .equipment-tab-button {
                padding: 6px 8px;
                font-size: 12px;
                margin: 0 2px;
            }
            
            .equipment-tab-button span {
                font-size: 9px;
            }
        }

        /* Optimizaciones de rendimiento */
        .glass-card,
        .glass-button,
        .glass-progress {
            will-change: transform, backdrop-filter;
        }

        /* Estilos para el panel de detalles de la línea de tiempo */
        #timeline-details-sheet {
            transform: translateY(100%);
        }
        #timeline-details-sheet.active {
            transform: translateY(0);
        }

        #timeline-filters .filter-button.active {
            background-color: var(--glass-accent-amber);
            color: var(--glass-bg-primary);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            border-color: var(--glass-accent-amber);
            font-weight: 600;
        }

        #timeline-filters .filter-button.active {
            background-color: var(--glass-accent-amber);
            color: var(--glass-bg-primary);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            border-color: var(--glass-accent-amber);
            font-weight: 600;
        }
    </style>
</head>
<body>

    <!-- Barra superior fija -->
    <nav id="top-navigation">
        <div class="top-nav-container">
            <!-- Logo/Título -->
            <a href="#" class="top-nav-logo" id="home-logo">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                ER Asistente
            </a>

            <!-- Acciones de la barra superior -->
            <div class="top-nav-actions">
                <!-- Botón de búsqueda -->
                <button id="search-toggle" class="top-nav-button" title="Buscar">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>

                <!-- Botón de menú hamburguesa -->
                <div class="relative">
                    <button id="menu-toggle" class="top-nav-button" title="Menú">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>

                    <!-- Menú desplegable -->
                    <div id="dropdown-menu" class="dropdown-menu">
                        <a href="#" class="dropdown-item" data-nav="zones">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            Zonas y Jefes
                        </a>
                        <a href="#" class="dropdown-item" data-nav="equipment">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                            </svg>
                            Equipamiento
                        </a>
                        <a href="#" class="dropdown-item" data-nav="items">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                            </svg>
                            Objetos
                        </a>
                        <a href="#" class="dropdown-item" data-nav="legendarios">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Legendarios
                        </a>
                        <a href="#" class="dropdown-item" id="installButton-top" style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Instalar App
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Búsqueda expandida -->
        <div id="search-expanded" class="search-expanded">
            <input 
                type="text" 
                id="top-search-input" 
                placeholder="Buscar jefes, armas, objetos, ubicaciones..." 
                class="w-full px-4 py-3 bg-zinc-800/50 border border-zinc-600/50 rounded-lg text-white placeholder-zinc-400 focus:outline-none focus:border-amber-400 focus:ring-2 focus:ring-amber-400/20 transition-all duration-300"
            >
            <div id="top-search-results" class="mt-4 hidden">
                <!-- Los resultados de búsqueda se mostrarán aquí -->
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-2 md:p-6 max-w-6xl main-content">

        <!-- Pantalla de Lista de Jefes -->
        <main id="screen-zones">
            <header class="text-center mb-8">
                
                <div class="glass-card p-6 max-w-lg mx-auto glass-slide-in">
                    <div class="flex justify-between mb-3">
                        <span class="text-base font-semibold text-amber-400">Progreso General</span>
                        <span id="overall-progress-text" class="text-sm font-semibold text-amber-400">0%</span>
                    </div>
                    <div class="glass-progress w-full h-3">
                        <div id="overall-progress-bar" class="glass-progress-bar h-3" style="width: 0%"></div>
                    </div>
                </div>
            </header>

            <div id="loading-indicator" class="text-center text-amber-400 text-xl py-10 glass-card p-6 max-w-md mx-auto glass-fade-in">Cargando zonas...</div>
            <div id="zone-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-24">
                <!-- Las tarjetas de las zonas se insertarán aquí por JavaScript -->
            </div>
        </main>
        
        <!-- Pantalla de Jefes de Zona (oculta por defecto) -->
        <main id="screen-zone-detail" class="hidden">
            <header class="mb-8">
                <button id="back-to-zones-button" class="glass-button flex items-center text-amber-400 hover:text-amber-300 font-semibold px-4 py-3 glass-fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    Volver a las Zonas
                </button>
            </header>
            <div class="text-center mb-6">
                <h1 id="zone-detail-title" class="glass-title text-4xl font-bold"></h1>
            </div>

            <!-- Pestañas de navegación -->
            <nav class="glass-nav flex justify-center p-2 mb-8 max-w-2xl mx-auto glass-slide-in">
                <button data-tab="jefes" class="tab-button glass-nav-button active font-semibold text-amber-400 py-3 px-6 mx-1">Jefes <span id="jefes-progress-text" class="text-xs ml-1"></span></button>
                <button data-tab="misiones" class="tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-6 mx-1">Misiones <span id="misiones-progress-text" class="text-xs ml-1"></span></button>
                <button data-tab="armas" class="tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-6 mx-1">Armas <span id="armas-progress-text" class="text-xs ml-1"></span></button>
                <button data-tab="objetos" class="tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-6 mx-1">Objetos <span id="objetos-progress-text" class="text-xs ml-1"></span></button>
            </nav>

            <!-- Contenido de las pestañas -->
            <div id="tab-content-container" class="pb-24">
                <div id="tab-jefes" class="tab-content grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Contenido de Jefes -->
                </div>
                <div id="tab-misiones" class="tab-content hidden space-y-3">
                    <!-- Contenido de Misiones -->
                </div>
                <div id="tab-armas" class="tab-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Armas -->
                </div>
                <div id="tab-objetos" class="tab-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Objetos -->
                </div>
            </div>
        </main>

        <!-- Pantalla de Detalle de Jefe (oculta por defecto) -->
        <main id="screen-detail" class="hidden">
            <header class="mb-8">
                <button id="back-button" class="glass-button flex items-center text-amber-400 hover:text-amber-300 font-semibold px-4 py-3 glass-fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    Volver
                </button>
            </header>

            <!-- Contenedor para los detalles del jefe -->
            <div id="detail-content" class="grid grid-cols-1 md:grid-cols-3 gap-8 pb-24">
                <div class="md:col-span-1">
                    <img id="detail-image" src="" alt="Imagen del jefe" class="glass-card w-full h-auto object-cover p-2 glass-slide-in">
                </div>
                <div class="md:col-span-2">
                    <h2 id="detail-name" class="glass-title text-4xl font-bold mb-4"></h2>
                    <div id="detail-status" class="mb-4"></div>
                    <p id="detail-description" class="text-zinc-300 mb-6 text-lg leading-relaxed"></p>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-md">
                        <div class="glass-card p-4 glass-fade-in">
                            <h3 class="font-bold text-amber-500 mb-2">Ubicación</h3>
                            <p id="detail-location" class="text-zinc-200"></p>
                        </div>
                        <div class="glass-card p-4 glass-fade-in">
                            <h3 class="font-bold text-amber-500 mb-2">Puntos de Vida</h3>
                            <p id="detail-health" class="text-zinc-200"></p>
                        </div>

                        <div class="glass-card p-4 glass-fade-in">
                            <h3 class="font-bold text-amber-500 mb-2">Recompensas (Drops)</h3>
                            <ul id="detail-drops" class="list-disc list-inside text-zinc-200"></ul>
                        </div>
                        <div class="glass-card p-4 glass-fade-in">
                            <h3 class="font-bold text-green-400 mb-2">Debilidades</h3>
                            <ul id="detail-weaknesses" class="list-disc list-inside text-zinc-200"></ul>
                        </div>
                        <div class="glass-card p-4 glass-fade-in">
                            <h3 class="font-bold text-red-400 mb-2">Fortalezas</h3>
                            <ul id="detail-strengths" class="list-disc list-inside text-zinc-200"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Pantalla de Detalle de Arma (oculta por defecto) -->
        <main id="screen-weapon-detail" class="hidden">
            <header class="mb-8">
                <button id="back-to-equipment-button" class="glass-button flex items-center text-amber-400 hover:text-amber-300 font-semibold px-4 py-3 glass-fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    Volver a Equipamiento
                </button>
            </header>

            <!-- Contenedor para los detalles del arma -->
            <div id="weapon-detail-content" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-1">
                    <img id="weapon-detail-image" src="" alt="Imagen del arma" class="glass-card w-full h-auto object-cover p-2 glass-slide-in">
                </div>
                <div class="md:col-span-2">
                    <h2 id="weapon-detail-name" class="glass-title text-4xl font-bold mb-4"></h2>
                    <p id="weapon-detail-description" class="text-zinc-300 mb-6 text-lg leading-relaxed"></p>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-md">
                        <div class="glass-card p-4 glass-fade-in">
                            <h3 class="font-bold text-amber-500 mb-2">Ubicación</h3>
                            <p id="weapon-detail-location" class="text-zinc-200"></p>
                        </div>
                        <div class="glass-card p-4 glass-fade-in">
                            <h3 class="font-bold text-amber-500 mb-2">Categoría</h3>
                            <p id="weapon-detail-category" class="text-zinc-200"></p>
                        </div>
                        <div class="glass-card p-4 glass-fade-in">
                            <h3 class="font-bold text-amber-500 mb-2">Peso</h3>
                            <p id="weapon-detail-weight" class="text-zinc-200"></p>
                        </div>
                        <div class="glass-card p-4 glass-fade-in col-span-full">
                            <h3 class="font-bold text-amber-500 mb-2">Ataque</h3>
                            <div id="weapon-detail-attack" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
                        </div>
                        <div class="glass-card p-4 glass-fade-in col-span-full">
                            <h3 class="font-bold text-amber-500 mb-2">Defensa</h3>
                            <div id="weapon-detail-defence" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
                        </div>
                         <div class="glass-card p-4 glass-fade-in col-span-full">
                            <h3 class="font-bold text-amber-500 mb-2">Atributos Requeridos</h3>
                            <div id="weapon-detail-required" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
                        </div>
                        <div class="glass-card p-4 glass-fade-in col-span-full">
                            <h3 class="font-bold text-amber-500 mb-2">Escalado de Atributos</h3>
                            <div id="weapon-detail-scales" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Pantalla de Equipamiento (oculta por defecto) -->
        <main id="screen-equipment" class="hidden">
            <header class="text-center mb-8">
                <h1 class="glass-title text-4xl font-bold mb-6">Equipamiento</h1>
                
                <div class="glass-card p-6 max-w-lg mx-auto glass-slide-in">
                    <div class="flex justify-between mb-3">
                        <span class="text-base font-semibold text-amber-400">Progreso de Equipamiento</span>
                        <span id="equipment-progress-text" class="text-sm font-semibold text-amber-400">0%</span>
                    </div>
                    <div class="glass-progress w-full h-3">
                        <div id="equipment-progress-bar" class="glass-progress-bar h-3" style="width: 0%"></div>
                    </div>
                </div>
            </header>

            <!-- Pestañas de navegación para equipamiento -->
            <nav class="glass-nav flex justify-center p-2 mb-8 max-w-6xl mx-auto glass-slide-in">
                <button data-equipment-tab="espadas" class="equipment-tab-button glass-nav-button active font-semibold text-amber-400 py-3 px-4 mx-1">Espadas <span id="espadas-total-count" class="text-xs ml-1"></span></button>
                <button data-equipment-tab="armas-pesadas" class="equipment-tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-4 mx-1">Armas Pesadas <span id="armas-pesadas-total-count" class="text-xs ml-1"></span></button>
                <button data-equipment-tab="armas-distancia" class="equipment-tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-4 mx-1">Distancia <span id="armas-distancia-total-count" class="text-xs ml-1"></span></button>
                <button data-equipment-tab="armas-magicas" class="equipment-tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-4 mx-1">Mágicas <span id="armas-magicas-total-count" class="text-xs ml-1"></span></button>
                <button data-equipment-tab="armaduras" class="equipment-tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-4 mx-1">Armaduras <span id="armaduras-total-count" class="text-xs ml-1"></span></button>
                <button data-equipment-tab="talismanes" class="equipment-tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-4 mx-1">Talismanes <span id="talismanes-total-count" class="text-xs ml-1"></span></button>
            </nav>

            <!-- Contenido de las pestañas de equipamiento -->
            <div id="equipment-content-container">
                <div id="equipment-espadas" class="equipment-content grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Espadas -->
                </div>
                <div id="equipment-armas-pesadas" class="equipment-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Armas Pesadas -->
                </div>
                <div id="equipment-armas-distancia" class="equipment-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Armas de Distancia -->
                </div>
                <div id="equipment-armas-magicas" class="equipment-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Armas Mágicas -->
                </div>
                <div id="equipment-armaduras" class="equipment-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Armaduras -->
                </div>
                <div id="equipment-talismanes" class="equipment-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Talismanes -->
                </div>
            </div>
        </main>

        <!-- Pantalla de Objetos (oculta por defecto) -->
        <main id="screen-items" class="hidden">
            <header class="text-center mb-8">
                <h1 class="glass-title text-4xl font-bold mb-6">Objetos</h1>
                
                <div class="glass-card p-6 max-w-lg mx-auto glass-slide-in">
                    <div class="flex justify-between mb-3">
                        <span class="text-base font-semibold text-amber-400">Progreso de Objetos</span>
                        <span id="items-progress-text" class="text-sm font-semibold text-amber-400">0%</span>
                    </div>
                    <div class="glass-progress w-full h-3">
                        <div id="items-progress-bar" class="glass-progress-bar h-3" style="width: 0%"></div>
                    </div>
                </div>
            </header>

            <!-- Pestañas de navegación para objetos -->
            <nav class="glass-nav flex justify-center p-2 mb-8 max-w-4xl mx-auto glass-slide-in">
                <button data-items-tab="consumibles" class="items-tab-button glass-nav-button active font-semibold text-amber-400 py-3 px-6 mx-1">Consumibles <span id="consumibles-total-count" class="text-xs ml-1"></span></button>
                <button data-items-tab="materiales" class="items-tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-6 mx-1">Materiales <span id="materiales-total-count" class="text-xs ml-1"></span></button>
                <button data-items-tab="claves" class="items-tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-6 mx-1">Claves <span id="claves-total-count" class="text-xs ml-1"></span></button>
                <button data-items-tab="otros" class="items-tab-button glass-nav-button font-semibold text-zinc-400 py-3 px-6 mx-1">Otros <span id="otros-total-count" class="text-xs ml-1"></span></button>
            </nav>

            <!-- Contenido de las pestañas de objetos -->
            <div id="items-content-container">
                <div id="items-consumibles" class="items-content grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Consumibles -->
                </div>
                <div id="items-materiales" class="items-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Materiales -->
                </div>
                <div id="items-claves" class="items-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Claves -->
                </div>
                <div id="items-otros" class="items-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Contenido de Otros -->
                </div>
            </div>
        </main>

        <!-- Pantalla de Guía/Línea de tiempo (oculta por defecto) -->
        <main id="screen-timeline" class="hidden">
             <div id="timeline-list-container" class="space-y-6 pb-24">
<div id="timeline-controls" class="p-2 mb-4 glass-card z-10">
    <h1 class="glass-title text-2xl font-bold text-center">Progresión Recomendada</h1>
                </div>
                <div id="timeline-list-content" class="space-y-6 px-4">
                    <!-- El contenido de la lista se generará aquí -->
                </div>
            </div>

            <!-- Panel de detalles inferior (Bottom Sheet) -->
            <div id="timeline-details-sheet" class="fixed bottom-0 left-0 right-0 z-[110] p-4 transition-transform duration-300 ease-in-out">
                <div class="glass-card p-6 max-w-2xl mx-auto rounded-t-lg relative" style="max-height: 85vh; overflow-y: auto;">
                     <button id="timeline-sheet-close" class="absolute top-4 right-4 text-zinc-400 hover:text-white text-3xl leading-none">&times;</button>
                     <h2 id="timeline-sheet-title" class="glass-title text-2xl mb-2 pr-8"></h2>
                     <p id="timeline-sheet-description" class="text-zinc-300"></p>
                     <div id="timeline-sheet-items" class="mt-4 border-t border-zinc-700/50 pt-4"></div>
                </div>
            </div>
        </main>

        <!-- Pantalla de Legendarios (oculta por defecto) -->
        <main id="screen-legendarios" class="hidden">
            <header class="text-center mb-8">
                <h1 class="glass-title text-4xl font-bold mb-4">Guías Legendarias</h1>
                <p class="text-zinc-300 text-lg">Construye los mejores personajes con estas guías detalladas</p>
            </header>

            <div class="max-w-6xl mx-auto px-4 pb-24">
                <div id="legendarios-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Las tarjetas de las guías se insertarán aquí por JavaScript -->
                </div>
            </div>
        </main>

        <!-- Pantalla de Detalle de Guía Legendaria (oculta por defecto) -->
        <main id="screen-legendario-detail" class="hidden">
            <header class="mb-8">
                <button id="back-to-legendarios-button" class="glass-button flex items-center text-amber-400 hover:text-amber-300 font-semibold px-4 py-3 glass-fade-in">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    Volver a las Guías
                </button>
            </header>
            
            <div class="text-center mb-6">
                <h1 id="legendario-detail-title" class="glass-title text-4xl font-bold"></h1>
                <p id="legendario-detail-subtitle" class="text-zinc-400 text-lg mt-2"></p>
            </div>

            <!-- Barra de progreso de la guía -->
            <div class="glass-card p-6 max-w-2xl mx-auto mb-8 glass-slide-in">
                <div class="flex justify-between mb-3">
                    <span class="text-base font-semibold text-amber-400">Progreso de la Guía</span>
                    <span id="legendario-progress-text" class="text-sm font-semibold text-amber-400">0%</span>
                </div>
                <div class="glass-progress w-full h-3">
                    <div id="legendario-progress-bar" class="glass-progress-bar h-3" style="width: 0%"></div>
                </div>
            </div>

            <!-- Contenido de la guía -->
            <div id="legendario-content" class="max-w-4xl mx-auto px-4 pb-24">
                <!-- El contenido de la guía se generará aquí -->
            </div>
        </main>

    </div>

    <!-- Navegación inferior fija -->
    <nav id="bottom-navigation" class="fixed bottom-0 left-0 right-0 z-50 glass-nav p-2">
        <div class="container mx-auto max-w-6xl">
            <div class="flex justify-around items-end">
                <button id="nav-zones" class="bottom-nav-button glass-nav-button active flex flex-col items-center py-2 px-4 text-amber-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span class="text-xs font-medium">Zonas</span>
                </button>
                <button id="nav-equipment" class="bottom-nav-button glass-nav-button flex flex-col items-center py-2 px-4 text-zinc-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    <span class="text-xs font-medium">Equipamiento</span>
                </button>
                <button id="nav-items" class="bottom-nav-button glass-nav-button flex flex-col items-center py-2 px-4 text-zinc-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                    </svg>
                    <span class="text-xs font-medium">Objetos</span>
                </button>
                <button id="nav-timeline" class="bottom-nav-button glass-nav-button flex flex-col items-center py-2 px-4 text-zinc-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 16.382V5.618a1 1 0 00-.553-.894L15 2m-6 5l6 3m-6-3l6 3" />
                    </svg>
                    <span class="text-xs font-medium">Guía</span>
                </button>
                <button id="nav-legendarios" class="bottom-nav-button glass-nav-button flex flex-col items-center py-2 px-4 text-zinc-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-xs font-medium">Legendarios</span>
                </button>
                <button id="installButton-nav" class="bottom-nav-button glass-nav-button flex flex-col items-center py-2 px-4 text-zinc-400" style="display: none;">
                    <svg class="h-6 w-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    <span class="text-xs font-medium">Instalar</span>
                </button>
            </div>
        </div>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // La API no tiene endpoint de misiones, las mantenemos localmente.
            const mockMissions = [
                { id: "mision01", name: "Misión de Ranni", description: "Ayuda a la bruja Ranni a desafiar a los Dos Dedos y forjar la Edad de las Estrellas.", location: "Liurnia of the Lakes" },
                { id: "mision02", name: "Misión de Fia", description: "Conviértete en el campeón de Fia, la Compañera de la Muerte, para dar a luz a la Runa de la Muerte.", location: "Deeproot Depths" },
                { id: "mision03", name: "Misión de Hyetta", description: "Guía a la doncella Hyetta hacia los Tres Dedos para que se convierta en la portadora de la Llama Frenética.", location: "Subterranean Shunning-Grounds" }
            ];

            const mockLegendarios = [
                {
                    id: "samurai-legendario",
                    title: "Samurái Legendario",
                    subtitle: "Guía completa para crear el mejor Samurái",
                    icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",
                    color: "from-red-500 to-red-700",
                    borderColor: "border-red-500",
                    steps: [
                        {
                            id: "creacion-personaje",
                            title: "Creación y preparación inicial del personaje",
                            color: "amber-400",
                            items: [
                                "Crear un nuevo personaje y elegir la clase Samurái",
                                "Personalizar el personaje y elegir el recuerdo de la Llave de Espada de Piedra",
                                "Completar el tutorial para obtener entre 500 y 600 runas y asignar todos los frascos a la sanación"
                            ]
                        },
                        {
                            id: "primeros-pasos",
                            title: "Primeros pasos y obtención del Mangual",
                            color: "blue-400",
                            items: [
                                "Salir a Limgrave y dirigirse a la Iglesia de Elleh para recoger una Runa Dorada y la primera Piedra de Herrería",
                                "Recoger las runas doradas de los cráneos que brillan en el suelo",
                                "Acabar con los soldados de Godrick y entrar en la cueva a la izquierda del camino (presumiblemente la Cueva de Forja)",
                                "Ignorar a los lobos en la cueva y derrotar al jefe final para obtener aproximadamente 1000 runas y un amuleto",
                                "Al salir, acabar con todos los enemigos hasta las runas frente al Castillo de Stormville",
                                "Dirigirse completamente a la derecha hacia una carroza para obtener el Mangual, un arma clave para la guía",
                                "Farmear hasta tener 3000 runas para subir la Destreza a 18 (el Samurái empieza con 15)",
                                "Aceptar la misión de Melina para obtener a Torrent",
                                "Subir los tres niveles de Destreza necesarios"
                            ]
                        },
                        {
                            id: "items-clave",
                            title: "Ítems clave y exploración temprana",
                            color: "green-400",
                            items: [
                                "Con Torrent, dirigirse al final de las ruinas para coger el mapa y luego a la derecha para encontrar la Piedra de Afilar",
                                "Volver a la Iglesia de Elleh para encontrar a Renna y obtener los espíritus de los lobos",
                                "Bajar a la playa detrás del Primer Paso, entrar en la cueva a la izquierda, derrotar a los dos semihumanos grandes con ayuda de los lobos",
                                "En la isla al final de la cueva, obtener una Piedra Sombreada Nivel 1 y una Piedra de Herrería Nivel 2",
                                "Comprar tres Piedras de Herrería al mercader al final de la playa",
                                "Encontrar una Pata de Ave Encurtida en Oro cerca de unos esqueletos que se levantan"
                            ]
                        },
                        {
                            id: "misiones-materiales",
                            title: "Misiones y materiales de mejora",
                            color: "purple-400",
                            items: [
                                "En el sector del Lago, encontrar una Piedra de Herrería Nivel 1 y hablar con Yura para iniciar su misión",
                                "Pasar por debajo del puente, ser invadido y derrotar al enemigo",
                                "Continuar por el río, encontrar a Yura de nuevo y agotar todos sus diálogos",
                                "Dirigirse a la cueva de Patches, activar su pelea, perdonarle la vida y comprar tres Patas Encurtidas en Oro",
                                "Continuar alrededor del lago, subir a una colina para encontrar la quinta Pata de Ave Encurtida en Oro",
                                "Entrar a Stormville, subir hasta la primera Semilla Dorada, ir a la derecha y llamar la atención de un gigante para que rompa una estatua, obteniendo Piedras de Herrería Nivel 1 y 2"
                            ]
                        },
                        {
                            id: "caelid-farmeo",
                            title: "Viaje a Caelid y farmeo de runas",
                            color: "red-400",
                            items: [
                                "Detrás de la Tercera Iglesia de Marika, tomar un teletransportador a Caelid",
                                "Ignorar enemigos, encontrar una Semilla Dorada debajo de una gárgola gigante",
                                "Cruzar el puente, evitar al dragón gigante, dirigirse detrás de un árbol para encontrar un torbellino",
                                "Usar el torbellino para subir a la montaña y llegar a Fort Faroth, un punto clave para el farmeo de runas",
                                "Dentro de Fort Faroth, seguir la ruta milimétrica para evitar enemigos, subir y obtener la parte derecha del Medallón de Dectus de un cofre",
                                "Saltar por los agujeros en el suelo, buscar el Medallón de Radagon",
                                "Volver al campo de gracia, ponerse el medallón y aceptar ir a la Mesa Redonda con Melina",
                                "En la Mesa Redonda, ir con Hewg para mejorar el Mangual con las Piedras de Herrería Nivel 1",
                                "Farmear runas atacando al dragón durmiente con el Mangual para provocarle sangrado",
                                "Obtener aproximadamente 300,000 runas y dar prioridad a Destreza, Vigor y Tolerancia"
                            ]
                        },
                        {
                            id: "mas-items",
                            title: "Más ítems y habilidades",
                            color: "yellow-400",
                            items: [
                                "Dirigirse al sur por la muralla quemada, pasar un escarabajo gigante, lanzarse por un precipicio a unas ramas y cruzar a una cueva con Podredumbre Escarlata",
                                "Navegar la cueva con cuidado para evitar la Podredumbre Escarlata y derrotar a los dos jefes finales con el Mangual",
                                "Obtener el Escarabajo Dorado, un emblema que facilita el farmeo de runas",
                                "Dirigirse al Pantano de Aeonia, a Caelia, la Antigua Ciudad, y disparar a un escarabajo para obtener la ceniza de guerra \"Corte Doble\"",
                                "Subir y al fondo a la izquierda, encontrar otra Semilla Dorada",
                                "Entrar a los Túneles de Cristal de Caelid, recoger Piedras de Herrería y derrotar al jefe con el Mangual",
                                "Obtener la Campana de Minero de Piedras Sombreadas Nivel 1"
                            ]
                        },
                        {
                            id: "armas-mejoras",
                            title: "Armas y mejoras adicionales",
                            color: "indigo-400",
                            items: [
                                "Dirigirse a la Cueva de la Prisión y usar la Llave de Espada de Piedra inicial para abrir celdas y obtener el Wakizashi",
                                "Entrar al Túnel Gaélico, ignorar enemigos y derrotar al jefe para obtener la Katana del Velo Lunar",
                                "Dirigirse a las ruinas donde aúlla Blaidd y encontrar una Piedra de Herrería Nivel 2 en un cofre",
                                "Dirigirse al Pequeño Árbol Áureo para obtener más Lágrimas para la mezcla de cataplasma",
                                "Comprar tres Piedras de Herrería Nivel 1 al mercader a la orilla del camino",
                                "Llegar al fuerte al final de Caelid (Fort Gael), evitar enemigos, derrotar a un caballero para obtener su ceniza de guerra",
                                "Subir a la torre más alta del fuerte para encontrar la parte izquierda del Medallón de Dectus",
                                "Debajo del castillo, encontrar otra Piedra de Herrería Nivel 1"
                            ]
                        },
                        {
                            id: "peninsula-llanto",
                            title: "Península del Llanto y Castillo Morne",
                            color: "pink-400",
                            items: [
                                "Volver a Limgrave, cruzar el Puente del Sacrificio hacia la Península del Llanto",
                                "Encontrar una Piedra de Herrería y una Llave de Espada de Piedra",
                                "Encontrar otra Piedra de Herrería Nivel 2 y comprar otra Piedra de Herrería Nivel 2 y Nivel 3 al mercader",
                                "Encontrar otra Piedra de Herrería Nivel 1 al otro lado de la muralla y una Semilla Dorada",
                                "Dirigirse a la izquierda del Castillo Morne para encontrar una Piedra Sombreada de Herrería Nivel 2",
                                "Entrar al Castillo Morne, ir a la izquierda evitando perros, coger una Piedra de Herrería Nivel 2",
                                "Correr por el castillo, evitar la Claymore, coger la Piedra de Herrería Nivel 2 al final de la pared",
                                "En la primera torre, encontrar el Talismán de Hojas Gemelas",
                                "Bajar por la parte trasera del castillo, con cuidado, para encontrar un cadáver con una Piedra de Herrería Nivel 2",
                                "Detrás de una estructura antes del jefe, encontrar otra Piedra Sombreada de Herrería Nivel 1",
                                "Cruzar el puente, llegar a la Iglesia de la Peregrinación, coger la Lágrima Sagrada",
                                "Cruzar al valle a la otra iglesia para encontrar otra Lágrima Sagrada",
                                "Bajar a la playa, comprar la Lámpara y tres Piedras de Herrería Nivel 2 al mercader",
                                "Volver a la Mesa Redonda, mejorar el Mangual a Nivel 7 con Hewg y usar las piedras restantes en las Katanas"
                            ]
                        },
                        {
                            id: "liurnia-academia",
                            title: "Liurnia de los Lagos y Academia",
                            color: "teal-400",
                            items: [
                                "Al llegar a la entrada de Stormville, ir a la derecha para encontrar un camino oculto con un puente roto y cruzar a Liurnia",
                                "En Liurnia, al lado izquierdo, en la Iglesia de Irith, encontrar otra Lágrima Sagrada",
                                "Comprar las Piedras de Herrería a la venta al primer mercader",
                                "Llegar a las puertas de la Academia de Raya Lucaria, activar el campo de gracia",
                                "Ir por detrás del dragón para coger la llave de la Academia",
                                "Dirigirse al Túnel de Cristal de Raya Lucaria, coger piedras si se desea, y derrotar al jefe con el Mangual",
                                "Obtener la Campana de Minero de Piedras de Herrería Nivel 1",
                                "Entrar a la Academia de Raya Lucaria, ir a la plaza principal, tomar el camino de la derecha, activar la señal de invocación para invadir un Tárnished",
                                "Derrotar al Tárnished, volver a Liurnia, encontrar a Yura para que te regale una Piedra de Herrería Nivel 5 y agotar sus diálogos",
                                "Al final del puente, encontrar una Semilla Dorada"
                            ]
                        },
                        {
                            id: "farum-altus",
                            title: "Farum Azula y Meseta Altus",
                            color: "orange-400",
                            items: [
                                "Dirigirse a los Cuatro Campanarios, ir al más alto, encontrar una Llave de Espada Imbuida",
                                "Usar la llave en la puerta de más abajo (\"Tierras Desmoronadas\") para activar el portal a Farum Azula",
                                "Realizar un segundo \"run warp\" para regresar a la entrada principal de Farum Azula",
                                "Encontrar una Piedra de Herrería Nivel 8 y, al bajar, en una terraza, encontrar la Campana de Minero de Piedras Sombreadas Nivel 4",
                                "Volver a la plaza de Raya Lucaria, activar el sello que lleva al Camino de Bellum",
                                "Un poco a la izquierda, en la Iglesia de Bellum, encontrar otra Lágrima Sagrada",
                                "Continuar el camino, evitar enemigos, y llegar al Elevador de Dectus para subir a la Meseta de Altus",
                                "Continuar por el camino principal, a la izquierda, encontrar una Semilla Dorada",
                                "Seguir a la izquierda, llegar a la segunda Iglesia de Marika, encontrar a Yura moribundo",
                                "Derrotar a Eleonora (que invadirá) para obtener la Hoja de Asta de Eleonora y la Nagakiba de Yura",
                                "Recordar coger la Lágrima Sagrada de la iglesia",
                                "En las runas, conseguir una Piedra Sombreada de Herrería Nivel 5",
                                "Bajar para encontrar unas criaturas que guardan un escarabajo que contiene otra Piedra Sombreada de Herrería Nivel 5",
                                "Entrar al Túnel de Altus, derrotar a los jefes finales con el mangual",
                                "Obtener la Campana de Minero de Rodamiento de Piedras (permite comprar piedras Nivel 3 y 4)"
                            ]
                        },
                        {
                            id: "leyndell-tierras",
                            title: "Leyndell y Tierras Prohibidas",
                            color: "cyan-400",
                            items: [
                                "Continuar hasta la ciudad (Leyndell), pasar corriendo por la entrada complicada",
                                "Al final, encontrar un campo de gracia con dos Semillas Doradas",
                                "A la izquierda, cerca del acantilado, encontrar una bajada a un pequeño lago que lleva a una cueva",
                                "En la cueva (Túnel Sellado), rodar para abrir el camino secreto entre la estaca de invocación y la farola",
                                "Justo a la derecha, encontrar la segunda Campana Minera de Rodamiento",
                                "Seguir subiendo por las afueras de la ciudad para encontrar otras dos Semillas Doradas y, cerca de un comerciante, otra Piedra de Herrería Nivel 5",
                                "Dirigirse al Pequeño Árbol Áureo, coger las Lágrimas de Cristal",
                                "Cerca de los arqueros gigantes, coger la Piedra de Herrería Nivel 5 en el centro",
                                "Bajar por un camino a la derecha de los Gólems a la Tumba Lateral de Auria, tocar el campo de gracia",
                                "Equipar \"Corte Sangriento\" con afinidad de Sangre en una Uchigatana",
                                "Realizar un \"zip glitch\" en el acantilado para llegar a las Tierras Nevadas",
                                "Realizar otro \"run warp\" para aparecer en la parte superior del Gran Elevador de Rold"
                            ]
                        },
                        {
                            id: "picos-gigantes",
                            title: "Picos de los Gigantes y Armamento Final",
                            color: "rose-400",
                            items: [
                                "Continuar en territorio de gigantes, en el primer punto de gracia, encontrar y matar a Shabiri para obtener el set de armadura de Yura",
                                "En las ruinas de Zamor, a la derecha, encontrar otra Campana de Rodamiento (Nivel 3, para comprar piedras Nivel 5 y 6)",
                                "En el Lago Congelado del Norte, en una iglesia con un cadáver, encontrar la Campana de Piedras Sombreadas Nivel 3",
                                "Dentro de la Primera Iglesia de Marika, encontrar una Lágrima de Cristal",
                                "Dirigirse a la parte del mapa donde invadirá un \"ronin\" para obtener la Katana Ríos de Sangre",
                                "Dirigirse al Túnel de Yelough Anix, bajar el ascensor y tocar el campo de gracia",
                                "Subir, equipar el medallón de runas, y realizar el \"salto de farmeo\" para obtener aproximadamente 200,000 runas",
                                "En la Mesa Redonda, ofrecer todas las Campanas de Minero a las Hermanas Gemelas para poder comprar Piedras de Herrería del Nivel 1 al 6 y Piedras Sombreadas del Nivel 1 al 8",
                                "Calcular y comprar las 12 piedras de cada nivel por cada una de las siete armas",
                                "Ir con Hewg para aplicar las Cenizas de Guerra recomendadas",
                                "Priorizar las estadísticas Destreza y Arcano, y también Vigor y Aguante",
                                "Practicar el intercambio rápido entre katanas para usar sus diferentes Cenizas de Guerra"
                            ]
                        }
                    ],
                    conclusion: "🎯 A partir de este punto, el personaje estará listo para el \"endgame\" y podrá empezar a jugar la historia, derrotando a todos los jefes y semidioses de las Tierras Intermedias como un Samurái legendario."
                }
            ];

            // Elementos del DOM
            const screenZones = document.getElementById('screen-zones');
            const screenZoneDetail = document.getElementById('screen-zone-detail');
            const screenDetail = document.getElementById('screen-detail');
            const screenWeaponDetail = document.getElementById('screen-weapon-detail');
            const screenEquipment = document.getElementById('screen-equipment');
            const screenItems = document.getElementById('screen-items');
            const screenTimeline = document.getElementById('screen-timeline');
            const timelineDetailsSheet = document.getElementById('timeline-details-sheet');
            const timelineSheetClose = document.getElementById('timeline-sheet-close');
            const timelineSheetTitle = document.getElementById('timeline-sheet-title');
            const timelineSheetDescription = document.getElementById('timeline-sheet-description');
            const timelineSheetItems = document.getElementById('timeline-sheet-items');
            const timelineListContainer = document.getElementById('timeline-list-container');

            timelineSheetClose.addEventListener('click', () => {
                timelineDetailsSheet.classList.remove('active');
            });

            // Elementos de la Guía
            const timelineListContent = document.getElementById('timeline-list-content');

            const zoneListContainer = document.getElementById('zone-list');
            const zoneDetailTitle = document.getElementById('zone-detail-title');
            const loadingIndicator = document.getElementById('loading-indicator');
            const backButton = document.getElementById('back-button');
            const backToZonesButton = document.getElementById('back-to-zones-button');
            const backToLegendariosButton = document.getElementById('back-to-legendarios-button');
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Elementos de navegación inferior
            const navZones = document.getElementById('nav-zones');
            const navEquipment = document.getElementById('nav-equipment');
            const navItems = document.getElementById('nav-items');
            const navTimeline = document.getElementById('nav-timeline');
            const navLegendarios = document.getElementById('nav-legendarios');
            const bottomNavButtons = document.querySelectorAll('.bottom-nav-button');

            // Elementos de la barra superior
            const homeLogo = document.getElementById('home-logo');
            const searchToggle = document.getElementById('search-toggle');
            const menuToggle = document.getElementById('menu-toggle');
            const dropdownMenu = document.getElementById('dropdown-menu');
            const searchExpanded = document.getElementById('search-expanded');
            const topSearchInput = document.getElementById('top-search-input');
            const dropdownItems = document.querySelectorAll('.dropdown-item');
            
            // Elementos de tabs de equipamiento
            const equipmentTabButtons = document.querySelectorAll('.equipment-tab-button');
            const equipmentContents = document.querySelectorAll('.equipment-content');
            
            // Elementos de tabs de objetos
            const itemsTabButtons = document.querySelectorAll('.items-tab-button');
            const itemsContents = document.querySelectorAll('.items-content');

            let gameData = { zones: {}, bosses: [], weapons: [], items: [], misiones: mockMissions, timeline: [], legendarios: mockLegendarios };
            let progressState = {};
            const STORAGE_KEY = 'eldenRingProgress';
            let currentZoneId = null;
            let currentTimelineData = [];

            // --- MANEJO DE ESTADO Y PROGRESO ---
            function loadProgress() {
                const savedProgress = localStorage.getItem(STORAGE_KEY);
                progressState = savedProgress ? JSON.parse(savedProgress) : {};
            }

            function saveProgress() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(progressState));
            }

            // --- FUNCIONES DE RENDERIZADO Y UI ---

            function renderZones() {
                updateOverallProgressUI();

                try {
                    const zones = Object.values(gameData.zones);

                    // Obtener las dificultades de las regiones y convertirlas a valores numéricos
                    const difficultyValues = {
                        'Fácil': 1,
                        'Medio': 2,
                        'Difícil': 3,
                        'Muy Difícil': 4
                    };
                    
                    const regionDifficulties = {};
                    gameData.regionsDifficulty.forEach(region => {
                        regionDifficulties[region.name] = difficultyValues[region.difficulty] || 999;
                    });

                    // Ordenar las zonas por dificultad de menor a mayor
                    zones.sort((a, b) => {
                        const difficultyA = regionDifficulties[a.name] || 999;
                        const difficultyB = regionDifficulties[b.name] || 999;
                        return difficultyA - difficultyB;
                    });
                    if (!zones || zones.length === 0) throw new Error('No se encontraron datos de zonas en el mock.');
                    
                    loadingIndicator.style.display = 'none';
                    zoneListContainer.innerHTML = ''; // Limpiar la lista

                    zones.forEach(zone => {
                        const zoneProgress = calculateZoneProgress(zone.id);
                        const card = document.createElement('div');
                        card.className = 'glass-card p-6 cursor-pointer glass-slide-in';
                        card.dataset.id = zone.id;

                        card.innerHTML = `
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="font-orbitron text-2xl font-bold text-white">${zone.name}</h3>
                                <span class="text-amber-400 font-semibold">${zoneProgress.toFixed(0)}%</span>
                            </div>
                            <p class="text-zinc-400 text-sm mt-2 mb-4 h-10">${zone.description || 'Una de las regiones de las Tierras Intermedias.'}</p>
                            <div class="glass-progress w-full h-3">
                                <div class="glass-progress-bar h-3" style="width: ${zoneProgress}%"></div>
                            </div>
                        `;
                        card.addEventListener('click', () => {
                            card.classList.add('glass-press');
                            setTimeout(() => card.classList.remove('glass-press'), 200);
                            showZoneDetail(zone.id);
                        });
                        zoneListContainer.appendChild(card);
                    });

                } catch (error) {
                    console.error(error);
                    // Mostramos un mensaje de error más descriptivo en la UI
                    loadingIndicator.innerHTML = `
                        <p class="text-red-400 font-semibold">Error al cargar las zonas.</p>
                        <p class="text-zinc-400 text-sm mt-2">${error.message}</p>`;
                }
            }

            function updateOverallProgressUI() {
                const overallProgress = calculateOverallProgress();
                const progressBar = document.getElementById('overall-progress-bar');
                const progressText = document.getElementById('overall-progress-text');
                if (progressBar) progressBar.style.width = `${overallProgress}%`;
                if (progressText) progressText.textContent = `${overallProgress.toFixed(0)}%`;
            }

            function handleCheckboxChange(e) {
                const itemId = e.target.dataset.id;
                const isChecked = e.target.checked;
                progressState[itemId] = isChecked;
                saveProgress();

                // Re-render la vista actual para actualizar barras de progreso
                if (currentZoneId) {
                    showZoneDetail(currentZoneId);
                }
            }

            // Función para manejar gestos de swipe
            function handleSwipeGesture(itemId, isCompleted) {
                progressState[itemId] = isCompleted;
                saveProgress();

                // Re-render la vista actual para actualizar barras de progreso
                if (currentZoneId) {
                    showZoneDetail(currentZoneId);
                }
            }

            // Clase para manejar gestos de swipe y tap
            class SwipeHandler {
                constructor(element, itemId, onSwipeCallback, onClickCallback) {
                    this.element = element;
                    this.itemId = itemId;
                    this.onSwipeCallback = onSwipeCallback;
                    this.onClickCallback = onClickCallback;

                    this.startX = 0;
                    this.startY = 0;
                    this.currentX = 0;
                    this.isDragging = false;
                    this.wasSwiped = false;
                    this.threshold = 80; // Distancia mínima para considerar swipe (aumentado de 50)
                    
                    this.init();
                }

                init() {
                    // Touch events
                    this.element.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: true });
                    this.element.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });
                    this.element.addEventListener('touchend', this.handleTouchEnd.bind(this));
                    
                    // Mouse events
                    this.element.addEventListener('mousedown', this.handleMouseDown.bind(this));

                    // Click event (para manejar taps)
                    this.element.addEventListener('click', this.handleClick.bind(this));
                }

                handleTouchStart(e) {
                    if (e.touches.length > 1) return;
                    this.startX = e.touches[0].clientX;
                    this.startY = e.touches[0].clientY;
                    this.isDragging = true;
                    this.wasSwiped = false;
                    this.element.style.transition = 'none';
                }

                handleTouchMove(e) {
                    if (!this.isDragging || e.touches.length > 1) return;
                    
                    this.currentX = e.touches[0].clientX;
                    const deltaX = this.currentX - this.startX;
                    const deltaY = e.touches[0].clientY - this.startY;

                    if (Math.abs(deltaX) > Math.abs(deltaY) + 10) { // Prioritize horizontal movement
                        e.preventDefault();
                        this.updateOverlay(deltaX);
                    }
                }

                handleTouchEnd() {
                    if (!this.isDragging) return;
                    this.isDragging = false;
                    this.element.style.transition = '';

                    const deltaX = this.currentX - this.startX;
                    if (Math.abs(deltaX) > this.threshold) {
                        this.wasSwiped = true;
                        this.toggleCompletion(deltaX > 0);
                    }
                    this.resetOverlay();
                }

                handleMouseDown(e) {
                    this.startX = e.clientX;
                    this.isDragging = true;
                    this.wasSwiped = false;
                    this.element.style.transition = 'none';

                    const handleMouseMove = (event) => {
                        if (!this.isDragging) return;
                        this.currentX = event.clientX;
                        const deltaX = this.currentX - this.startX;
                        this.updateOverlay(deltaX);
                    };

                    const handleMouseUp = () => {
                        if (!this.isDragging) return;
                        this.isDragging = false;
                        this.element.style.transition = '';

                        const deltaX = this.currentX - this.startX;
                        if (Math.abs(deltaX) > this.threshold) {
                            this.wasSwiped = true;
                            this.toggleCompletion(deltaX > 0);
                        }
                        this.resetOverlay();

                        document.removeEventListener('mousemove', handleMouseMove);
                        document.removeEventListener('mouseup', handleMouseUp);
                    };
                    
                    document.addEventListener('mousemove', handleMouseMove);
                    document.addEventListener('mouseup', handleMouseUp);
                }

                handleClick(e) {
                    if (this.wasSwiped) {
                        e.preventDefault();
                        e.stopPropagation();
                        return;
                    }
                    if (this.onClickCallback) {
                        this.onClickCallback();
                    }
                }

                updateOverlay(deltaX) {
                    const overlay = this.element.querySelector('.swipe-overlay');
                    if (!overlay) return;

                    const progress = Math.min(Math.abs(deltaX) / (this.element.offsetWidth * 0.7), 1);
                    
                    if (deltaX > 0) { // Right swipe
                        overlay.style.transform = `translateX(${(progress - 1) * 100}%)`;
                        overlay.classList.remove('unmark');
                        overlay.querySelector('span').textContent = 'Completar';
                    } else { // Left swipe
                        overlay.style.transform = `translateX(-${(1 - progress) * 100}%)`;
                        overlay.classList.add('unmark');
                        overlay.querySelector('span').textContent = 'Desmarcar';
                    }
                }

                toggleCompletion(isCompleted) {
                    const currentState = progressState[this.itemId] || false;
                    if (currentState === isCompleted) return;

                    if (navigator.vibrate) navigator.vibrate(50);
                    
                    this.element.classList.add('swipe-completed');
                    setTimeout(() => this.element.classList.remove('swipe-completed'), 600);

                    handleSwipeGesture(this.itemId, isCompleted);

                    this.element.classList.toggle('completed', isCompleted);
                    const textElement = this.element.querySelector('.item-name');
                    if (textElement) {
                        textElement.classList.toggle('line-through', isCompleted);
                        textElement.classList.toggle('text-zinc-400', isCompleted);
                    }
                    
                    if (this.onSwipeCallback) this.onSwipeCallback();
                }

                resetOverlay() {
                    const overlay = this.element.querySelector('.swipe-overlay');
                    if (overlay) {
                        overlay.style.transition = 'transform 0.3s ease';
                        overlay.style.transform = 'translateX(-100%)';
                        setTimeout(() => {
                           overlay.style.transition = '';
                        }, 300);
                    }
                }
            }

            function renderTabContent(zone, category) {
                const container = document.getElementById(`tab-${category}`);
                let itemIds = zone[category] || [];
                
                if (!gameData[category]) {
                    console.warn(`Categoría '${category}' no encontrada en gameData`);
                    container.innerHTML = `<div class="glass-card col-span-full text-center p-6 glass-fade-in"><p class="text-zinc-400">Categoría '${category}' no disponible.</p></div>`;
                    return;
                }
                
                if (category === 'jefes') {
                    itemIds = sortBossesByDifficulty([...itemIds]);
                }
                
                const items = gameData[category].filter(item => itemIds.includes(item.id));
                container.innerHTML = '';

                if (items.length === 0) {
                    container.innerHTML = `<div class="glass-card col-span-full text-center p-6 glass-fade-in"><p class="text-zinc-400">No hay ${category} registrados en esta zona.</p></div>`;
                    return;
                }

                items.forEach((item, index) => {
                    const isChecked = progressState[item.id] || false;
                    const card = document.createElement('div');
                    card.className = `glass-card swipe-container p-4 glass-slide-in ${isChecked ? 'completed' : ''}`;
                    card.dataset.id = item.id;

                    let contentHtml = '';
                    let onClickCallback;

                    if (category === 'jefes') {
                        const difficulty = calculateBossDifficulty(item);
                        const difficultyText = difficulty <= 2 ? 'Fácil' : difficulty <= 4 ? 'Medio' : 'Difícil';
                        const difficultyColor = difficulty <= 2 ? 'text-green-400' : difficulty <= 4 ? 'text-yellow-400' : 'text-red-400';
                        contentHtml = `
                            <div class="flex-grow">
                                <div class="flex items-center justify-between">
                                    <span class="item-name text-white font-semibold ${isChecked ? 'line-through text-zinc-400' : ''}">${index + 1}. ${item.name}</span>
                                    <span class="text-xs ${difficultyColor} font-medium">${difficultyText}</span>
                                </div>
                                <div class="flex items-center mt-2 text-xs text-zinc-400">
                                    <span>${item.healthPoints || '???'} HP</span>
                                    ${item.drops && item.drops.find(drop => drop.includes('Runes')) ?
                                        `<span class="ml-3">${item.drops.find(drop => drop.includes('Runes'))}</span>` : ''}
                                </div>
                            </div>`;
                        onClickCallback = () => showBossDetail(item.id, zone.id);
                    } else {
                        contentHtml = `
                            <div>
                                <span class="item-name font-bold text-white ${isChecked ? 'line-through text-zinc-400' : ''}">${item.name}</span>
                                <p class="text-zinc-400 text-sm mt-1">${item.description}</p>
                            </div>`;
                        onClickCallback = () => showItemDetail(item.id, category);
                    }

                    card.innerHTML = `
                        ${contentHtml}
                        <div class="swipe-overlay"><span>${isChecked ? 'Desmarcar' : 'Completar'}</span></div>
                        <div class="swipe-hint">← Desliza</div>
                    `;

                    container.appendChild(card);
                    new SwipeHandler(card, item.id, () => showZoneDetail(zone.id), onClickCallback);
                });
            }

            function showZoneDetail(zoneId) {
                currentZoneId = zoneId;

                // Ocultar todas las pantallas excepto la de detalle de zona
                document.querySelectorAll('main').forEach(screen => {
                    screen.classList.add('hidden');
                });
                screenZoneDetail.classList.remove('hidden');

                const zone = gameData.zones[zoneId];
                if (!zone) {
                    zoneDetailTitle.textContent = 'Zona no encontrada';
                    return;
                }

                zoneDetailTitle.textContent = zone.name;

                // Renderizar contenido para todas las pestañas
                renderTabContent(zone, 'jefes');
                renderTabContent(zone, 'misiones');
                renderTabContent(zone, 'armas');
                renderTabContent(zone, 'objetos');
                
                // Agregar indicador de ordenamiento por dificultad en la pestaña de jefes
                
                const jefesTab = document.getElementById('tab-jefes');
                if (jefesTab && zone.jefes && zone.jefes.length > 0) {
                    const orderIndicator = document.createElement('div');
                    orderIndicator.className = 'glass-card text-xs text-zinc-500 text-center mb-4 p-3 glass-fade-in';
                    orderIndicator.innerHTML = '🗡️ Jefes ordenados por dificultad (más fácil → más difícil)';
                    jefesTab.insertBefore(orderIndicator, jefesTab.firstChild);
                }

                // Actualizar porcentajes de las pestañas
                ['jefes', 'misiones', 'armas', 'objetos'].forEach(category => {
                    const progress = calculateProgress(zone[category] || []);
                    const textElement = document.getElementById(`${category}-progress-text`);
                    if (textElement) {
                        textElement.textContent = `(${progress.toFixed(0)}%)`;
                    }
                });

                // Activar la primera pestaña por defecto
                tabButtons.forEach(btn => {
                    if (btn.dataset.tab === 'jefes') {
                        btn.classList.add('text-amber-400', 'active');
                        btn.classList.remove('text-zinc-400');
                    } else {
                        btn.classList.remove('text-amber-400', 'active');
                        btn.classList.add('text-zinc-400');
                    }
                });
                tabContents.forEach(content => {
                    if (content.id === 'tab-jefes') {
                        content.classList.remove('hidden');
                        content.classList.add('glass-fade-in');
                    } else {
                        content.classList.add('hidden');
                    }
                });

                window.scrollTo(0, 0);
            }

            // --- FUNCIONES DE CÁLCULO ---
            
            // Función para calcular la dificultad de un jefe
            function calculateBossDifficulty(boss) {
                let difficulty = 0;
                
                // Basado en puntos de vida
                if (boss.healthPoints) {
                    const health = parseInt(boss.healthPoints.replace(/[^\d]/g, '')) || 0;
                    if (health > 0) {
                        if (health < 5000) difficulty += 1;
                        else if (health < 15000) difficulty += 2;
                        else if (health < 50000) difficulty += 3;
                        else difficulty += 4;
                    }
                }
                
                // Basado en runas (recompensa)
                if (boss.drops) {
                    const runes = boss.drops.find(drop => drop.includes('Runes'));
                    if (runes) {
                        const runeAmount = parseInt(runes.replace(/[^\d]/g, '')) || 0;
                        if (runeAmount > 100000) difficulty += 3;
                        else if (runeAmount > 50000) difficulty += 2;
                        else if (runeAmount > 10000) difficulty += 1;
                    }
                }
                
                // Jefes especiales conocidos por su dificultad
                const hardBosses = ['malenia', 'elden beast', 'radagon', 'maliketh', 'radahn'];
                if (hardBosses.some(hardBoss => boss.name.toLowerCase().includes(hardBoss))) {
                    difficulty += 2;
                }
                
                return difficulty;
            }
            
            // Función para ordenar jefes por dificultad
            function sortBossesByDifficulty(bossIds) {
                return bossIds.sort((a, b) => {
                    const bossA = gameData.bosses.find(boss => boss.id === a);
                    const bossB = gameData.bosses.find(boss => boss.id === b);
                    
                    if (!bossA || !bossB) return 0;
                    
                    const difficultyA = calculateBossDifficulty(bossA);
                    const difficultyB = calculateBossDifficulty(bossB);
                    
                    return difficultyA - difficultyB; // Orden ascendente (más fácil primero)
                });
            }
            
            function calculateProgress(itemIds) {
                if (!itemIds || itemIds.length === 0) return 100;
                const completedItems = itemIds.filter(id => progressState[id]).length;
                return (completedItems / itemIds.length) * 100;
            }

            function calculateZoneProgress(zoneId) {
                const zone = gameData.zones[zoneId];
                if (!zone) return 0;
                const bossProgress = calculateProgress(zone.jefes || []);
                const missionProgress = calculateProgress(zone.misiones || []);
                return (bossProgress + missionProgress) / 2;
            }

            function calculateOverallProgress() {
                const zoneIds = Object.keys(gameData.zones);
                if (zoneIds.length === 0) return 0;
                const totalProgress = zoneIds.reduce((sum, zoneId) => sum + calculateZoneProgress(zoneId), 0);
                return totalProgress / zoneIds.length;
            }

            window.showBossDetail = function(bossId, fromZoneId) {
                // Ocultar todas las pantallas excepto la de detalle de jefe
                document.querySelectorAll('main').forEach(screen => {
                    screen.classList.add('hidden');
                });
                screenDetail.classList.remove('hidden');
                document.getElementById('detail-content').classList.add('hidden');

                try {
                    const boss = gameData.bosses.find(b => b.id === bossId);
                    if (!boss) throw new Error('No se pudo encontrar el detalle del jefe.');

                    // Guardar el contexto de la zona para el botón de regreso
                    backButton.dataset.fromZone = fromZoneId;

                    // Rellenar los detalles
                    document.getElementById('detail-image').src = boss.image || 'https://via.placeholder.com/400x225.png?text=No+Image';
                    document.getElementById('detail-name').textContent = boss.name;
                    
                    // Mostrar estado del jefe (completado o pendiente)
                    const statusElement = document.getElementById('detail-status');
                    const isCompleted = progressState[boss.id] || false;
                    statusElement.innerHTML = `
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${
                            isCompleted 
                                ? 'bg-green-500/20 text-green-400 border border-green-500/30' 
                                : 'bg-orange-500/20 text-orange-400 border border-orange-500/30'
                        }">
                            ${isCompleted ? '✅ Completado' : '⏳ Pendiente'}
                        </span>
                    `;
                    
                    document.getElementById('detail-description').textContent = boss.description || 'No hay descripción disponible.';
                    document.getElementById('detail-location').textContent = boss.location || 'Desconocida';
                    document.getElementById('detail-health').textContent = boss.healthPoints || 'No disponible';
                    
                    const dropsList = document.getElementById('detail-drops');
                    dropsList.innerHTML = '';

                    if (boss.drops && boss.drops.length > 0) {
                        boss.drops.forEach(drop => {
                            const li = document.createElement('li');
                            li.textContent = drop;
                            dropsList.appendChild(li);
                        });
                    } else {
                        dropsList.innerHTML = '<li>No se conocen recompensas.</li>';
                    }

                    const weaknessesList = document.getElementById('detail-weaknesses');
                    weaknessesList.innerHTML = '';
                    if (boss.weaknesses && boss.weaknesses.length > 0) {
                        boss.weaknesses.forEach(weakness => {
                            const li = document.createElement('li');
                            li.textContent = weakness;
                            weaknessesList.appendChild(li);
                        });
                    } else {
                        weaknessesList.innerHTML = '<li>Ninguna conocida.</li>';
                    }

                    const strengthsList = document.getElementById('detail-strengths');
                    strengthsList.innerHTML = '';
                    if (boss.strengths && boss.strengths.length > 0) {
                        boss.strengths.forEach(strength => {
                            const li = document.createElement('li');
                            li.textContent = strength;
                            strengthsList.appendChild(li);
                        });
                    } else {
                        strengthsList.innerHTML = '<li>Ninguna conocida.</li>';
                    }

                    document.getElementById('detail-content').classList.remove('hidden'); // Mostrar contenido
                    document.getElementById('detail-content').classList.add('glass-fade-in'); // Agregar animación
                    window.scrollTo(0, 0); // Ir al inicio de la página

                } catch (error) {
                    // Si falla la carga del detalle, mostramos un error claro
                    document.getElementById('detail-name').textContent = 'Error al cargar';
                    document.getElementById('detail-description').textContent = `No se pudo obtener el detalle de este jefe. ${error.message}`;
                    console.error(error);
                }
            }

            function showWeaponDetail(weaponId) {
                document.querySelectorAll('main').forEach(screen => {
                    screen.classList.add('hidden');
                });
                const weaponDetailScreen = document.getElementById('screen-weapon-detail');
                weaponDetailScreen.classList.remove('hidden');
                document.getElementById('weapon-detail-content').classList.add('hidden');

                try {
                    const weapon = gameData.weapons.find(w => w.id === weaponId);
                    if (!weapon) throw new Error('No se pudo encontrar el detalle del arma.');

                    document.getElementById('weapon-detail-image').src = weapon.image || 'https://via.placeholder.com/400x225.png?text=No+Image';
                    document.getElementById('weapon-detail-name').textContent = weapon.name;
                    document.getElementById('weapon-detail-description').textContent = weapon.description || 'No hay descripción disponible.';
                    document.getElementById('weapon-detail-location').textContent = weapon.location || 'Desconocida';
                    document.getElementById('weapon-detail-category').textContent = weapon.category || 'N/A';
                    document.getElementById('weapon-detail-weight').textContent = weapon.weight || 'N/A';

                    const attackContainer = document.getElementById('weapon-detail-attack');
                    attackContainer.innerHTML = '';
                    if (weapon.attack && weapon.attack.length > 0) {
                        weapon.attack.forEach(stat => {
                            attackContainer.innerHTML += `<div class="flex justify-between"><span>${stat.name}:</span><span>${stat.amount}</span></div>`;
                        });
                    }

                    const defenceContainer = document.getElementById('weapon-detail-defence');
                    defenceContainer.innerHTML = '';
                    if (weapon.defence && weapon.defence.length > 0) {
                        weapon.defence.forEach(stat => {
                            defenceContainer.innerHTML += `<div class="flex justify-between"><span>${stat.name}:</span><span>${stat.amount}</span></div>`;
                        });
                    }

                    const requiredContainer = document.getElementById('weapon-detail-required');
                    requiredContainer.innerHTML = '';
                    if (weapon.requiredAttributes && weapon.requiredAttributes.length > 0) {
                        weapon.requiredAttributes.forEach(stat => {
                            requiredContainer.innerHTML += `<div class="flex justify-between"><span>${stat.name}:</span><span>${stat.amount}</span></div>`;
                        });
                    }

                    const scalesContainer = document.getElementById('weapon-detail-scales');
                    scalesContainer.innerHTML = '';
                    if (weapon.scalesWith && weapon.scalesWith.length > 0) {
                        weapon.scalesWith.forEach(stat => {
                            scalesContainer.innerHTML += `<div class="flex justify-between"><span>${stat.name}:</span><span>${stat.scaling}</span></div>`;
                        });
                    }

                    document.getElementById('weapon-detail-content').classList.remove('hidden');
                    document.getElementById('weapon-detail-content').classList.add('glass-fade-in');
                    window.scrollTo(0, 0);

                } catch (error) {
                    document.getElementById('weapon-detail-name').textContent = 'Error al cargar';
                    document.getElementById('weapon-detail-description').textContent = `No se pudo obtener el detalle de esta arma. ${error.message}`;
                    console.error(error);
                }
            }

            window.showItemDetail = function(itemId, category) {
                // Ocultar todas las pantallas excepto la de detalle
                document.querySelectorAll('main').forEach(screen => {
                    screen.classList.add('hidden');
                });
                screenDetail.classList.remove('hidden');
                document.getElementById('detail-content').classList.add('hidden');

                // Configurar el botón de regreso para volver a la pantalla principal
                backButton.dataset.fromZone = null;

                try {
                    // Buscar el item en la categoría correspondiente
                    let item = null;
                    let itemData = null;

                    switch(category) {
                        case 'items':
                            itemData = gameData.items;
                            break;
                        case 'talismans':
                            itemData = gameData.talismans;
                            break;
                        case 'armors':
                            itemData = gameData.armors;
                            break;
                        case 'shields':
                            itemData = gameData.shields;
                            break;
                        case 'ammos':
                            itemData = gameData.ammos;
                            break;
                        case 'ashes':
                            itemData = gameData.ashes;
                            break;
                        case 'spirits':
                            itemData = gameData.spirits;
                            break;
                        case 'sorceries':
                            itemData = gameData.sorceries;
                            break;
                        case 'incantations':
                            itemData = gameData.incantations;
                            break;
                        default:
                            throw new Error('Categoría no válida');
                    }

                    item = itemData.find(i => i.id === itemId);
                    if (!item) throw new Error('No se pudo encontrar el detalle del objeto.');

                    // Rellenar los detalles básicos
                    document.getElementById('detail-image').src = item.image || 'https://via.placeholder.com/400x225.png?text=No+Image';
                    document.getElementById('detail-name').textContent = item.name;
                    document.getElementById('detail-description').textContent = item.description || 'No hay descripción disponible.';
                    
                    // Configurar campos específicos según el tipo de item
                    const locationElement = document.getElementById('detail-location');
                    const healthElement = document.getElementById('detail-health');
                    const dropsElement = document.getElementById('detail-drops');
                    const weaknessesElement = document.getElementById('detail-weaknesses');
                    const strengthsElement = document.getElementById('detail-strengths');

                    // Ubicación
                    if (item.location) {
                        locationElement.textContent = item.location;
                    } else {
                        locationElement.textContent = 'Desconocida';
                    }

                    // Puntos de vida (si aplica)
                    if (item.healthPoints) {
                        healthElement.textContent = item.healthPoints;
                    } else {
                        healthElement.textContent = 'N/A';
                    }



                    // Efectos o drops
                    dropsElement.innerHTML = '';
                    if (item.effect) {
                        const li = document.createElement('li');
                        li.textContent = item.effect;
                        dropsElement.appendChild(li);
                    } else if (item.drops && item.drops.length > 0) {
                        item.drops.forEach(drop => {
                            const li = document.createElement('li');
                            li.textContent = drop;
                            dropsElement.appendChild(li);
                        });
                    } else {
                        dropsElement.innerHTML = '<li>No se conocen efectos especiales.</li>';
                    }

                    // Debilidades (si aplica)
                    weaknessesElement.innerHTML = '';
                    if (item.weaknesses && item.weaknesses.length > 0) {
                        item.weaknesses.forEach(weakness => {
                            const li = document.createElement('li');
                            li.textContent = weakness;
                            weaknessesElement.appendChild(li);
                        });
                    } else {
                        weaknessesElement.innerHTML = '<li>N/A</li>';
                    }

                    // Fortalezas (si aplica)
                    strengthsElement.innerHTML = '';
                    if (item.strengths && item.strengths.length > 0) {
                        item.strengths.forEach(strength => {
                            const li = document.createElement('li');
                            li.textContent = strength;
                            strengthsElement.appendChild(li);
                        });
                    } else {
                        strengthsElement.innerHTML = '<li>N/A</li>';
                    }

                    // Mostrar el contenido y hacer scroll al inicio
                    document.getElementById('detail-content').classList.remove('hidden');
                    document.getElementById('detail-content').classList.add('glass-fade-in');
                    window.scrollTo(0, 0);

                } catch (error) {
                    document.getElementById('detail-name').textContent = 'Error al cargar';
                    document.getElementById('detail-description').textContent = `No se pudo obtener el detalle de este objeto. ${error.message}`;
                    console.error(error);
                }
            }

            function processApiData() {
                // Primero, inicializamos las zonas a partir de las regiones únicas en locations.json
                gameData.zones = {}; // Limpiar zonas existentes
                const uniqueRegions = new Set();

                gameData.locations.forEach(location => {
                    if (location.region && !uniqueRegions.has(location.region)) {
                        const zoneName = location.region.trim();
                        const zoneId = zoneName.toLowerCase().replace(/\s+/g, '-');
                        gameData.zones[zoneId] = {
                            id: zoneId,
                            name: zoneName,
                            description: `Explora la región de ${zoneName}.`,
                            jefes: [],
                            misiones: [],
                            armas: [],
                            objetos: []
                        };
                        uniqueRegions.add(location.region);
                    }
                });

                // Mapeo automático de jefes a regiones basado en los datos reales (español)
                gameData.bosses.forEach(boss => {
                    if (!boss.region) return;
                    
                    // Convertir el nombre de la región a un ID de zona
                    let regionId = null;
                    const regionName = boss.region.toLowerCase();
                    
                    if (regionName.includes('limgrave')) {
                        regionId = 'limgrave';
                    } else if (regionName.includes('península llorona')) {
                        regionId = 'weeping-peninsula';
                    } else if (regionName.includes('liurnia de los lagos') || regionName.includes('liurnia')) {
                        regionId = 'liurnia-of-the-lakes';
                    } else if (regionName.includes('caelid')) {
                        regionId = 'caelid';
                    } else if (regionName.includes('meseta de altus') || regionName.includes('altus')) {
                        regionId = 'altus-pleateau';
                    } else if (regionName.includes('cumbres de los gigantes') || regionName.includes('campo de nieve consagrado') || regionName.includes('haligtree')) {
                        regionId = 'mountaintops-of-the-giants';
                    } else if (regionName.includes('monte gelmir') || regionName.includes('gelmir')) {
                        regionId = 'mount-gelmir';
                    } else if (regionName.includes('profundidades de raíz profunda') || regionName.includes('mohgwyn')) {
                        regionId = 'deeproot-depths';
                    } else if (regionName.includes('farum azula en ruinas') || regionName.includes('farum azula')) {
                        regionId = 'crumbling-farum-azula';
                    }

                    if (regionId && gameData.zones[regionId]) {
                        if (!gameData.zones[regionId].jefes.includes(boss.id)) {
                            gameData.zones[regionId].jefes.push(boss.id);
                        }
                    }
                });

                // Asignar objetos a sus regiones
                gameData.items.forEach(item => {
                    if (!item.location) return;
                    
                    // Mapeo manual de ubicaciones a regiones
                    let regionId = null;
                    if (item.location.includes('Limgrave') || item.location.includes('Stormhill') || item.location.includes('Stormveil')) {
                        regionId = 'limgrave';
                    } else if (item.location.includes('Weeping Peninsula') || item.location.includes('Castle Morne')) {
                        regionId = 'weeping-peninsula';
                    } else if (item.location.includes('Liurnia') || item.location.includes('Raya Lucaria')) {
                        regionId = 'liurnia-of-the-lakes';
                    } else if (item.location.includes('Caelid')) {
                        regionId = 'caelid';
                    } else if (item.location.includes('Altus Plateau') || item.location.includes('Leyndell')) {
                        regionId = 'altus-pleateau';
                    } else if (item.location.includes('Mountaintops') || item.location.includes('Haligtree')) {
                        regionId = 'mountaintops-of-the-giants';
                    }

                    if (regionId && gameData.zones[regionId]) {
                        if (!gameData.zones[regionId].objetos.includes(item.id)) {
                            gameData.zones[regionId].objetos.push(item.id);
                        }
                    }
                });

                // Asignar armas a regiones (ejemplo básico)
                gameData.weapons.forEach(weapon => {
                    if (!weapon.location) return;
                    
                    let regionId = null;
                    if (weapon.location.includes('Limgrave') || weapon.location.includes('Stormveil')) {
                        regionId = 'limgrave';
                    } else if (weapon.location.includes('Liurnia') || weapon.location.includes('Raya Lucaria')) {
                        regionId = 'liurnia-of-the-lakes';
                    } else if (weapon.location.includes('Caelid')) {
                        regionId = 'caelid';
                    }

                    if (regionId && gameData.zones[regionId]) {
                        if (!gameData.zones[regionId].armas.includes(weapon.id)) {
                            gameData.zones[regionId].armas.push(weapon.id);
                        }
                    }
                });

                // Asignar misiones a regiones basándose en la propiedad region del archivo
                if (gameData.misiones && gameData.misiones.length > 0) {
                    gameData.misiones.forEach(mision => {
                        if (mision.region && gameData.zones[mision.region]) {
                            if (!gameData.zones[mision.region].misiones.includes(mision.id)) {
                                gameData.zones[mision.region].misiones.push(mision.id);
                            }
                        }
                    });
                }

                console.log('Zonas procesadas:', Object.keys(gameData.zones));
                console.log('Jefes por zona:', Object.values(gameData.zones).map(zone => ({
                    name: zone.name,
                    jefes: zone.jefes.length,
                    objetos: zone.objetos.length,
                    armas: zone.armas.length,
                    misiones: zone.misiones.length
                })));
            }

            async function initializeApp() {
                try {
                    loadingIndicator.textContent = 'Cargando archivos de datos...';

                    const [bossesRes, weaponsRes, itemsRes, locationsRes, regionsDifficultyRes, missionsRes, armorsRes, shieldsRes, talismansRes, timelineRes] = await Promise.all([
                        fetch('./data/bosses_es.json'),
                        fetch('./data/weapons_es.json'),
                        fetch('./data/items_es.json'),
                        fetch('./data/locations_es.json'),
                        fetch('./data/regions_difficulty_es.json'),
                        fetch('./data/missions_es.json'),
                        fetch('./data/armors.json').catch(() => null),
                        fetch('./data/shields.json').catch(() => null),
                        fetch('./data/talismans.json').catch(() => null),
                        fetch('./data/timeline_necro_es.json')
                    ]);

                    // Los archivos JSON son arrays directamente, no necesitan .data
                    gameData.bosses = await bossesRes.json();
                    gameData.weapons = await weaponsRes.json();
                    gameData.items = await itemsRes.json();
                    gameData.timeline = await timelineRes.json();
                    gameData.locations = await locationsRes.json();
                    gameData.regionsDifficulty = await regionsDifficultyRes.json();
                    gameData.misiones = await missionsRes.json();
                    
                    // Cargar datos adicionales si están disponibles
                    if (armorsRes) {
                        gameData.armors = await armorsRes.json();
                    } else {
                        gameData.armors = [];
                    }
                    
                    if (shieldsRes) {
                        gameData.shields = await shieldsRes.json();
                    } else {
                        gameData.shields = [];
                    }
                    
                    if (talismansRes) {
                        gameData.talismans = await talismansRes.json();
                    } else {
                        gameData.talismans = [];
                    }
                    
                    // Inicializar categorías que pueden no existir
                    if (!gameData.armas) gameData.armas = [];
                    if (!gameData.objetos) gameData.objetos = [];
                    
                    // Crear alias para compatibilidad con nombres en español
                    gameData.jefes = gameData.bosses;
                    gameData.armas = gameData.weapons;
                    gameData.objetos = gameData.items;

                    processApiData();
                    console.log("Unique Regions:", Object.values(gameData.zones).map(zone => zone.name));
                    loadProgress();
                    renderZones();
                    renderLegendarios();

                    // Inicializar la guía para que esté lista
                    renderTimelineList(gameData.timeline);
                } catch (error) {
                    loadingIndicator.innerHTML = `<p class="text-red-400 font-semibold">Error al cargar los archivos de datos. Asegúrate de que la carpeta /data y los archivos JSON existen.</p><p class="text-zinc-400 text-sm mt-2">${error.message}</p>`;
                }
            }

            // --- FUNCIONES DE LA BARRA SUPERIOR ---
            function toggleDropdownMenu() {
                dropdownMenu.classList.toggle('active');
            }

            function hideDropdownMenu() {
                dropdownMenu.classList.remove('active');
            }

            function toggleSearchExpanded() {
                searchExpanded.classList.toggle('active');
                if (searchExpanded.classList.contains('active')) {
                    topSearchInput.focus();
                }
            }

            function hideSearchExpanded() {
                searchExpanded.classList.remove('active');
                topSearchInput.value = '';
                hideGeneralSearchResults();
            }

            // Función para actualizar el estado activo de la navegación inferior
            function updateBottomNavActive(activeButtonId) {
                // Remover clase active de todos los botones
                document.querySelectorAll('.bottom-nav-button').forEach(button => {
                    button.classList.remove('active');
                    button.classList.remove('text-amber-400');
                    button.classList.add('text-zinc-400');
                });
                
                // Agregar clase active al botón seleccionado
                const activeButton = document.getElementById(activeButtonId);
                if (activeButton) {
                    activeButton.classList.add('active');
                    activeButton.classList.remove('text-zinc-400');
                    activeButton.classList.add('text-amber-400');
                }
            }

            // --- FUNCIONES DE NAVEGACIÓN PRINCIPAL ---
            function showScreen(screenId) {
                // Ocultar todas las pantallas
                document.querySelectorAll('main').forEach(screen => {
                    screen.classList.add('hidden');
                });
                
                // Mostrar la pantalla seleccionada
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.remove('hidden');
                    targetScreen.classList.add('glass-fade-in');
                }
                
                // Actualizar navegación inferior
                bottomNavButtons.forEach(btn => {
                    btn.classList.remove('active', 'text-amber-400');
                    btn.classList.add('text-zinc-400');
                });
                
                // Activar el botón correspondiente
                if (screenId === 'screen-zones') {
                    navZones.classList.add('active', 'text-amber-400');
                    navZones.classList.remove('text-zinc-400');
                } else if (screenId === 'screen-equipment') {
                    navEquipment.classList.add('active', 'text-amber-400');
                    navEquipment.classList.remove('text-zinc-400');
                } else if (screenId === 'screen-items') {
                    navItems.classList.add('active', 'text-amber-400');
                    navItems.classList.remove('text-zinc-400');
                } else if (screenId === 'screen-timeline') {
                    navTimeline.classList.add('active', 'text-amber-400');
                    navTimeline.classList.remove('text-zinc-400');
                } else if (screenId === 'screen-legendarios') {
                    navLegendarios.classList.add('active', 'text-amber-400');
                    navLegendarios.classList.remove('text-zinc-400');
                }
                
                window.scrollTo(0, 0);
            }

            function renderEquipmentContent() {
                // Categorizar armas
                const espadas = gameData.weapons.filter(weapon => 
                    ['Straight Sword', 'Curved Sword', 'Thrusting Sword', 'Heavy Thrusting Sword', 'Katana', 'Dagger'].includes(weapon.category)
                );
                const armasPesadas = gameData.weapons.filter(weapon => 
                    ['Greatsword', 'Curved Greatsword', 'Colossal Sword', 'Colossal Weapon', 'Greataxe', 'Great Spear', 'Halberd', 'Hammer', 'Warhammer', 'Flail', 'Whip'].includes(weapon.category)
                );
                const armasDistancia = gameData.weapons.filter(weapon => 
                    ['Bow', 'Light Bow', 'Greatbow', 'Crossbow', 'Ballista'].includes(weapon.category)
                );
                const armasMagicas = gameData.weapons.filter(weapon => 
                    ['Glintstone Staff', 'Sacred Seal', 'Torch'].includes(weapon.category)
                );
                const armasEspeciales = gameData.weapons.filter(weapon => 
                    ['Claw', 'Fist', 'Reaper', 'Twinblade'].includes(weapon.category)
                );
                
                // Renderizar cada categoría
                renderEquipmentTab('espadas', espadas);
                renderEquipmentTab('armas-pesadas', armasPesadas);
                renderEquipmentTab('armas-distancia', armasDistancia);
                renderEquipmentTab('armas-magicas', [...armasMagicas, ...armasEspeciales]);
                
                // Renderizar armaduras (si tenemos datos)
                renderEquipmentTab('armaduras', gameData.armors || []);
                
                // Renderizar talismanes (si tenemos datos)
                renderEquipmentTab('talismanes', gameData.talismans || []);
                
                // Actualizar contadores
                updateEquipmentCounters();
            }

            function renderEquipmentTab(category, items) {
                const container = document.getElementById(`equipment-${category}`);
                if (!container) return;
                
                container.innerHTML = '';
                
                if (items.length === 0) {
                    container.innerHTML = `<div class="glass-card col-span-full text-center p-6 glass-fade-in"><p class="text-zinc-400">No hay ${category} disponibles.</p></div>`;
                    return;
                }
                
                // Mostrar indicador de carga
                container.innerHTML = '<div class="glass-card col-span-full text-center p-6 glass-fade-in"><p class="text-amber-400">Cargando...</p></div>';
                
                // Usar requestAnimationFrame para cargar de forma asíncrona
                requestAnimationFrame(() => {
                    let html = '';
                    const batchSize = 20; // Cargar de 20 en 20
                    let currentIndex = 0;
                    
                    function renderBatch() {
                        const endIndex = Math.min(currentIndex + batchSize, items.length);
                        
                        for (let i = currentIndex; i < endIndex; i++) {
                            const item = items[i];
                            const isChecked = progressState[item.id] || false;
                            html += `
                                <div class="glass-card swipe-container flex items-center p-4 cursor-pointer glass-slide-in ${isChecked ? 'completed' : ''}" data-id="${item.id}">
                                    <div class="flex-grow">
                                        <span class="font-bold text-white ${isChecked ? 'line-through text-zinc-400' : ''}">${item.name}</span>
                                        <p class="text-zinc-400 text-sm mt-1">${item.category || ''}</p>
                                    </div>
                                    <button data-weapon-id="${item.id}" class="glass-button view-weapon-detail-btn text-xs text-amber-500 px-3 py-1 ml-2">Ver</button>
                                    <div class="swipe-overlay">
                                        <span>${isChecked ? 'Desmarcar' : 'Completar'}</span>
                                    </div>
                                </div>
                            `;
                        }
                        
                        container.innerHTML = html;
                        
                        // Inicializar gestos de swipe para cada tarjeta
                        container.querySelectorAll('.swipe-container').forEach(container => {
                            const itemId = container.dataset.id;
                            new SwipeHandler(container, itemId);
                        });

                        container.querySelectorAll('.view-weapon-detail-btn').forEach(button => {
                            button.addEventListener('click', (e) => {
                                e.preventDefault();
                                button.classList.add('glass-press');
                                setTimeout(() => button.classList.remove('glass-press'), 200);
                                if (navigator.vibrate) {
                                    navigator.vibrate(100);
                                }
                                showWeaponDetail(e.target.dataset.weaponId);
                            });
                        });
                        
                        currentIndex = endIndex;
                        
                        // Si hay más elementos, continuar con el siguiente lote
                        if (currentIndex < items.length) {
                            requestAnimationFrame(renderBatch);
                        }
                    }
                    
                    renderBatch();
                });
            }

            function renderItemsContent() {
                // Categorizar objetos
                const consumibles = gameData.items.filter(item => 
                    item.type && (item.type.includes('consumible') || item.type.includes('poción') || item.type.includes('comida'))
                );
                const materiales = gameData.items.filter(item => 
                    item.type && (item.type.includes('material') || item.type.includes('crafting') || item.type.includes('upgrade'))
                );
                const claves = gameData.items.filter(item => 
                    item.type && (item.type.includes('key') || item.type.includes('clave') || item.type.includes('llave'))
                );
                const otros = gameData.items.filter(item => 
                    !consumibles.includes(item) && !materiales.includes(item) && !claves.includes(item)
                );
                
                // Renderizar cada categoría
                renderItemsTab('consumibles', consumibles);
                renderItemsTab('materiales', materiales);
                renderItemsTab('claves', claves);
                renderItemsTab('otros', otros);
                
                // Actualizar contadores
                updateItemsCounters();
            }

            function renderItemsTab(category, items) {
                const container = document.getElementById(`items-${category}`);
                if (!container) return;
                
                container.innerHTML = '';
                
                if (items.length === 0) {
                    container.innerHTML = `<div class="glass-card col-span-full text-center p-6 glass-fade-in"><p class="text-zinc-400">No hay ${category} disponibles.</p></div>`;
                    return;
                }
                
                // Mostrar indicador de carga
                container.innerHTML = '<div class="glass-card col-span-full text-center p-6 glass-fade-in"><p class="text-amber-400">Cargando...</p></div>';
                
                // Usar requestAnimationFrame para cargar de forma asíncrona
                requestAnimationFrame(() => {
                    let html = '';
                    const batchSize = 20; // Cargar de 20 en 20
                    let currentIndex = 0;
                    
                    function renderBatch() {
                        const endIndex = Math.min(currentIndex + batchSize, items.length);
                        
                        for (let i = currentIndex; i < endIndex; i++) {
                            const item = items[i];
                            const isChecked = progressState[item.id] || false;
                            html += `
                                <div class="glass-card swipe-container flex items-start p-4 cursor-pointer glass-slide-in ${isChecked ? 'completed' : ''}" data-id="${item.id}">
                                    <div>
                                        <span class="font-bold text-white ${isChecked ? 'line-through text-zinc-400' : ''}">${item.name}</span>
                                        <p class="text-zinc-400 text-sm mt-1">${item.description || 'Sin descripción disponible.'}</p>
                                        ${item.location ? `<p class="text-zinc-500 text-xs mt-2">📍 ${item.location}</p>` : ''}
                                    </div>
                                    <div class="swipe-overlay">
                                        <span>${isChecked ? 'Desmarcar' : 'Completar'}</span>
                                    </div>
                                </div>
                            `;
                        }
                        
                        container.innerHTML = html;
                        
                        // Inicializar gestos de swipe para cada tarjeta
                        container.querySelectorAll('.swipe-container').forEach(container => {
                            const itemId = container.dataset.id;
                            new SwipeHandler(container, itemId);
                        });
                        
                        currentIndex = endIndex;
                        
                        // Si hay más elementos, continuar con el siguiente lote
                        if (currentIndex < items.length) {
                            requestAnimationFrame(renderBatch);
                        }
                    }
                    
                    renderBatch();
                });
            }

            function updateEquipmentCounters() {
                // Calcular contadores para cada categoría de armas
                const espadas = gameData.weapons.filter(weapon => 
                    ['Straight Sword', 'Curved Sword', 'Thrusting Sword', 'Heavy Thrusting Sword', 'Katana', 'Dagger'].includes(weapon.category)
                ).length;
                const armasPesadas = gameData.weapons.filter(weapon => 
                    ['Greatsword', 'Curved Greatsword', 'Colossal Sword', 'Colossal Weapon', 'Greataxe', 'Great Spear', 'Halberd', 'Hammer', 'Warhammer', 'Flail', 'Whip'].includes(weapon.category)
                ).length;
                const armasDistancia = gameData.weapons.filter(weapon => 
                    ['Bow', 'Light Bow', 'Greatbow', 'Crossbow', 'Ballista'].includes(weapon.category)
                ).length;
                const armasMagicas = gameData.weapons.filter(weapon => 
                    ['Glintstone Staff', 'Sacred Seal', 'Torch', 'Claw', 'Fist', 'Reaper', 'Twinblade'].includes(weapon.category)
                ).length;
                
                const counters = {
                    'espadas': espadas,
                    'armas-pesadas': armasPesadas,
                    'armas-distancia': armasDistancia,
                    'armas-magicas': armasMagicas,
                    'armaduras': (gameData.armors || []).length,
                    'talismanes': (gameData.talismans || []).length
                };
                
                Object.entries(counters).forEach(([category, count]) => {
                    const counterElement = document.getElementById(`${category}-total-count`);
                    if (counterElement) {
                        counterElement.textContent = `(${count})`;
                    }
                });
            }

            function updateItemsCounters() {
                const consumibles = gameData.items.filter(item => 
                    item.type && (item.type.includes('consumible') || item.type.includes('poción') || item.type.includes('comida'))
                ).length;
                const materiales = gameData.items.filter(item => 
                    item.type && (item.type.includes('material') || item.type.includes('crafting') || item.type.includes('upgrade'))
                ).length;
                const claves = gameData.items.filter(item => 
                    item.type && (item.type.includes('key') || item.type.includes('clave') || item.type.includes('llave'))
                ).length;
                const otros = gameData.items.length - consumibles - materiales - claves;
                
                const counters = {
                    'consumibles': consumibles,
                    'materiales': materiales,
                    'claves': claves,
                    'otros': otros
                };
                
                Object.entries(counters).forEach(([category, count]) => {
                    const counterElement = document.getElementById(`${category}-total-count`);
                    if (counterElement) {
                        counterElement.textContent = `(${count})`;
                    }
                });
            }

            // --- FUNCIONES DE GUÍAS LEGENDARIAS ---
            function renderLegendarios() {
                const container = document.getElementById('legendarios-list');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (gameData.legendarios.length === 0) {
                    container.innerHTML = '<div class="glass-card col-span-full text-center p-6 glass-fade-in"><p class="text-zinc-400">No hay guías legendarias disponibles.</p></div>';
                    return;
                }
                
                gameData.legendarios.forEach(legendario => {
                    const progress = calculateLegendarioProgress(legendario.id);
                    const card = document.createElement('div');
                    card.className = 'glass-card p-6 cursor-pointer glass-fade-in';
                    card.dataset.id = legendario.id;
                    
                    card.innerHTML = `
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br ${legendario.color} rounded-lg flex items-center justify-center mr-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${legendario.icon}" />
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h3 class="glass-title text-xl font-bold">${legendario.title}</h3>
                                <p class="text-zinc-400 text-sm">${legendario.subtitle}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-amber-400 font-semibold text-lg">${progress.toFixed(0)}%</span>
                            </div>
                        </div>
                        <div class="glass-progress w-full h-2 mb-2">
                            <div class="glass-progress-bar h-2" style="width: ${progress}%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-zinc-500">
                            <span>${getCompletedSteps(legendario.id)} de ${getTotalSteps(legendario.id)} pasos completados</span>
                            <span>${legendario.steps.length} secciones</span>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => {
                        card.classList.add('glass-press');
                        setTimeout(() => card.classList.remove('glass-press'), 200);
                        showLegendarioDetail(legendario.id);
                    });
                    
                    container.appendChild(card);
                });
            }

            function calculateLegendarioProgress(legendarioId) {
                const legendario = gameData.legendarios.find(l => l.id === legendarioId);
                if (!legendario) return 0;
                
                let totalSteps = 0;
                let completedSteps = 0;
                
                legendario.steps.forEach(step => {
                    totalSteps += step.items.length;
                    step.items.forEach(item => {
                        const itemId = `${legendarioId}-${step.id}-${step.items.indexOf(item)}`;
                        if (progressState[itemId]) {
                            completedSteps++;
                        }
                    });
                });
                
                return totalSteps > 0 ? (completedSteps / totalSteps) * 100 : 0;
            }

            function getCompletedSteps(legendarioId) {
                const legendario = gameData.legendarios.find(l => l.id === legendarioId);
                if (!legendario) return 0;
                
                let completedSteps = 0;
                legendario.steps.forEach(step => {
                    step.items.forEach(item => {
                        const itemId = `${legendarioId}-${step.id}-${step.items.indexOf(item)}`;
                        if (progressState[itemId]) {
                            completedSteps++;
                        }
                    });
                });
                
                return completedSteps;
            }

            function getTotalSteps(legendarioId) {
                const legendario = gameData.legendarios.find(l => l.id === legendarioId);
                if (!legendario) return 0;
                
                let totalSteps = 0;
                legendario.steps.forEach(step => {
                    totalSteps += step.items.length;
                });
                
                return totalSteps;
            }

            function showLegendarioDetail(legendarioId) {
                const legendario = gameData.legendarios.find(l => l.id === legendarioId);
                if (!legendario) return;
                
                // Actualizar título y subtítulo
                document.getElementById('legendario-detail-title').textContent = legendario.title;
                document.getElementById('legendario-detail-subtitle').textContent = legendario.subtitle;
                
                // Actualizar progreso
                const progress = calculateLegendarioProgress(legendarioId);
                document.getElementById('legendario-progress-text').textContent = `${progress.toFixed(0)}%`;
                document.getElementById('legendario-progress-bar').style.width = `${progress}%`;
                
                // Renderizar contenido
                renderLegendarioContent(legendario);
                
                // Mostrar pantalla de detalle
                showScreen('screen-legendario-detail');
            }

            function renderLegendarioContent(legendario) {
                const container = document.getElementById('legendario-content');
                if (!container) return;
                
                let html = '';
                
                legendario.steps.forEach((step, stepIndex) => {
                    html += `
                        <div class="border-l-4 border-${step.color} pl-4 mb-6">
                            <h3 class="text-lg font-semibold text-${step.color} mb-3">${stepIndex + 1}. ${step.title}</h3>
                            <ul class="space-y-2">
                    `;
                    
                    step.items.forEach((item, itemIndex) => {
                        const itemId = `${legendario.id}-${step.id}-${itemIndex}`;
                        const isCompleted = progressState[itemId] || false;
                        
                        html += `
                            <li class="flex items-start space-x-3 text-zinc-300">
                                <button 
                                    class="w-5 h-5 rounded border-2 flex items-center justify-center mt-0.5 transition-all duration-200 ${
                                        isCompleted 
                                            ? 'bg-amber-400 border-amber-400 text-black' 
                                            : 'border-zinc-500 hover:border-amber-400'
                                    }"
                                    data-item-id="${itemId}"
                                    onclick="toggleLegendarioItem('${itemId}')"
                                >
                                    ${isCompleted ? '✓' : ''}
                                </button>
                                <span class="flex-1 ${isCompleted ? 'line-through text-zinc-500' : ''}">${item}</span>
                            </li>
                        `;
                    });
                    
                    html += `
                            </ul>
                        </div>
                    `;
                });
                
                // Agregar conclusión
                if (legendario.conclusion) {
                    html += `
                        <div class="mt-6 p-4 bg-gradient-to-r from-amber-900/20 to-yellow-900/20 rounded-lg border border-amber-500/30">
                            <p class="text-amber-200 font-semibold text-center">${legendario.conclusion}</p>
                        </div>
                    `;
                }
                
                container.innerHTML = html;
            }

            function toggleLegendarioItem(itemId) {
                progressState[itemId] = !progressState[itemId];
                saveProgress();
                
                // Re-renderizar el contenido actual
                const legendarioId = itemId.split('-')[0] + '-' + itemId.split('-')[1];
                const legendario = gameData.legendarios.find(l => l.id === legendarioId);
                if (legendario) {
                    renderLegendarioContent(legendario);
                    
                    // Actualizar progreso
                    const progress = calculateLegendarioProgress(legendarioId);
                    document.getElementById('legendario-progress-text').textContent = `${progress.toFixed(0)}%`;
                    document.getElementById('legendario-progress-bar').style.width = `${progress}%`;
                }
            }

            // --- NAVEGACIÓN ---
            backButton.addEventListener('click', () => {
                // Animación de cristal
                backButton.classList.add('glass-press');
                setTimeout(() => backButton.classList.remove('glass-press'), 200);
                // Retroalimentación háptica
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                const fromZone = backButton.dataset.fromZone;
                if (fromZone) {
                    showZoneDetail(fromZone);
                } else {
                    // Si no hay zona de origen, volver a la pantalla principal
                    document.querySelectorAll('main').forEach(screen => {
                        screen.classList.add('hidden');
                    });
                    document.getElementById('screen-main').classList.remove('hidden');
                    window.scrollTo(0, 0);
                }
            });

            const backToEquipmentButton = document.getElementById('back-to-equipment-button');
            backToEquipmentButton.addEventListener('click', () => {
                backToEquipmentButton.classList.add('glass-press');
                setTimeout(() => backToEquipmentButton.classList.remove('glass-press'), 200);
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                showScreen('screen-equipment');
            });

            backToZonesButton.addEventListener('click', () => {
                // Animación de cristal
                backToZonesButton.classList.add('glass-press');
                setTimeout(() => backToZonesButton.classList.remove('glass-press'), 200);
                // Retroalimentación háptica
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                screenZoneDetail.classList.add('hidden');
                currentZoneId = null;
                renderZones(); // Re-render para mostrar progreso actualizado
                screenZones.classList.remove('hidden');
            });

            backToLegendariosButton.addEventListener('click', () => {
                // Animación de cristal
                backToLegendariosButton.classList.add('glass-press');
                setTimeout(() => backToLegendariosButton.classList.remove('glass-press'), 200);
                // Retroalimentación háptica
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                showScreen('screen-legendarios');
                updateBottomNavActive('nav-legendarios');
                renderLegendarios(); // Re-render para mostrar progreso actualizado
            });

            // --- BARRA SUPERIOR ---
            // Logo para volver al inicio
            homeLogo.addEventListener('click', (e) => {
                e.preventDefault();
                homeLogo.classList.add('glass-press');
                setTimeout(() => homeLogo.classList.remove('glass-press'), 200);
                showScreen('screen-zones');
                updateBottomNavActive('nav-zones');
                hideDropdownMenu();
                hideSearchExpanded();
            });

            // Toggle de búsqueda
            searchToggle.addEventListener('click', () => {
                searchToggle.classList.add('glass-press');
                setTimeout(() => searchToggle.classList.remove('glass-press'), 200);
                toggleSearchExpanded();
                hideDropdownMenu();
            });

            // Toggle de menú desplegable
            menuToggle.addEventListener('click', () => {
                menuToggle.classList.add('glass-press');
                setTimeout(() => menuToggle.classList.remove('glass-press'), 200);
                toggleDropdownMenu();
                hideSearchExpanded();
            });

            // Navegación desde menú desplegable
            dropdownItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const navType = item.getAttribute('data-nav');
                    if (navType) {
                        item.classList.add('glass-press');
                        setTimeout(() => item.classList.remove('glass-press'), 200);
                        if (navType === 'zones') {
                            showScreen('screen-zones');
                            updateBottomNavActive('nav-zones');
                        } else if (navType === 'equipment') {
                            showScreen('screen-equipment');
                            updateBottomNavActive('nav-equipment');
                            renderEquipmentContent();
                        } else if (navType === 'items') {
                            showScreen('screen-items');
                            updateBottomNavActive('nav-items');
                            renderItemsContent();
                        } else if (navType === 'legendarios') {
                            showScreen('screen-legendarios');
                            updateBottomNavActive('nav-legendarios');
                        }
                        hideDropdownMenu();
                    }
                });
            });

            // Búsqueda en barra superior
            if (topSearchInput) {
                topSearchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        performGeneralSearch(e.target.value);
                    }, 300);
                });
            }

            // Cerrar menús al hacer clic fuera
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !dropdownMenu.contains(e.target)) {
                    hideDropdownMenu();
                }
                if (!searchToggle.contains(e.target) && !searchExpanded.contains(e.target)) {
                    hideSearchExpanded();
                }
            });

            // --- NAVEGACIÓN INFERIOR ---
            navZones.addEventListener('click', () => {
                navZones.classList.add('glass-press');
                setTimeout(() => navZones.classList.remove('glass-press'), 200);
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                showScreen('screen-zones');
                updateBottomNavActive('nav-zones');
            });

            navEquipment.addEventListener('click', () => {
                navEquipment.classList.add('glass-press');
                setTimeout(() => navEquipment.classList.remove('glass-press'), 200);
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                showScreen('screen-equipment');
                updateBottomNavActive('nav-equipment');
                renderEquipmentContent();
            });

            navItems.addEventListener('click', () => {
                navItems.classList.add('glass-press');
                setTimeout(() => navItems.classList.remove('glass-press'), 200);
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                showScreen('screen-items');
                updateBottomNavActive('nav-items');
                renderItemsContent();
            });

            navTimeline.addEventListener('click', () => {
                navTimeline.classList.add('glass-press');
                setTimeout(() => navTimeline.classList.remove('glass-press'), 200);
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                showScreen('screen-timeline');
                updateBottomNavActive('nav-timeline');
            });

            navLegendarios.addEventListener('click', () => {
                navLegendarios.classList.add('glass-press');
                setTimeout(() => navLegendarios.classList.remove('glass-press'), 200);
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                showScreen('screen-legendarios');
                updateBottomNavActive('nav-legendarios');
            });

            // --- LÓGICA DE LA GUÍA ---
            function showTimelineEventDetails(eventId) {
                const event = gameData.timeline.find(e => e.id === eventId);
                if (!event) return;

                timelineSheetTitle.textContent = event.title;
                timelineSheetDescription.textContent = event.description;

                timelineSheetItems.innerHTML = '';
                if (event.items && event.items.length > 0) {
                    const itemsHtml = event.items.map(item => `<span class="inline-block glass-button text-xs px-2 py-1 mr-2 mb-2">${item}</span>`).join('');
                    timelineSheetItems.innerHTML = `<h3 class="font-bold text-amber-400 mb-2">Objetos Clave</h3>${itemsHtml}`;
                }

                timelineDetailsSheet.classList.add('active');
            }


            function renderTimelineList(data) {
                if (!data) return;

                timelineListContent.innerHTML = ''; // Limpiar antes de renderizar

                const groupedBySection = data.reduce((acc, event) => {
                    (acc[event.section] = acc[event.section] || []).push(event);
                    return acc;
                }, {});

                if (Object.keys(groupedBySection).length === 0) {
                    timelineListContent.innerHTML = '<div class="text-center text-zinc-400 p-8">No se encontraron eventos que coincidan con tu búsqueda.</div>';
                    return;
                }

                for (const section in groupedBySection) {
                    const sectionHeader = document.createElement('h2');
                    sectionHeader.className = 'font-cinzel text-2xl text-amber-400 font-bold sticky top-20 bg-black/50 py-2';
                    sectionHeader.textContent = section;
                    timelineListContent.appendChild(sectionHeader);

                    const sectionContainer = document.createElement('div');
                    sectionContainer.className = 'space-y-4';

                    groupedBySection[section].forEach(event => {
                        const isChecked = progressState[event.id] || false;
                        const card = document.createElement('div');
                        card.className = `glass-card swipe-container p-4 glass-slide-in ${isChecked ? 'completed' : ''}`;
                        card.dataset.id = event.id;

                        card.innerHTML = `
                            <div>
                                <h3 class="item-name font-bold text-white ${isChecked ? 'line-through text-zinc-400' : ''}">${event.title}</h3>
                                <p class="text-zinc-400 text-sm mt-1">${event.description.substring(0, 100)}...</p>
                            </div>
                            <div class="swipe-overlay"><span>${isChecked ? 'Desmarcar' : 'Completar'}</span></div>
                            <div class="swipe-hint">← Desliza</div>
                        `;

                        sectionContainer.appendChild(card);
                        new SwipeHandler(card, event.id, null, () => showTimelineEventDetails(event.id));
                    });
                    timelineListContent.appendChild(sectionContainer);
                }
            }




            // --- TABS DE EQUIPAMIENTO ---
            equipmentTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    button.classList.add('glass-press');
                    setTimeout(() => button.classList.remove('glass-press'), 200);
                    if (navigator.vibrate) {
                        navigator.vibrate(30);
                    }
                    
                    const tabId = button.dataset.equipmentTab;

                    // Actualizar botones
                    equipmentTabButtons.forEach(btn => {
                        btn.classList.remove('text-amber-400', 'active');
                        btn.classList.add('text-zinc-400');
                    });
                    button.classList.add('text-amber-400', 'active');
                    button.classList.remove('text-zinc-400');

                    // Actualizar contenido
                    equipmentContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== `equipment-${tabId}`);
                        if (content.id === `equipment-${tabId}`) {
                            content.classList.add('glass-fade-in');
                        }
                    });
                });
            });

            // --- TABS DE OBJETOS ---
            itemsTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    button.classList.add('glass-press');
                    setTimeout(() => button.classList.remove('glass-press'), 200);
                    if (navigator.vibrate) {
                        navigator.vibrate(30);
                    }
                    
                    const tabId = button.dataset.itemsTab;

                    // Actualizar botones
                    itemsTabButtons.forEach(btn => {
                        btn.classList.remove('text-amber-400', 'active');
                        btn.classList.add('text-zinc-400');
                    });
                    button.classList.add('text-amber-400', 'active');
                    button.classList.remove('text-zinc-400');

                    // Actualizar contenido
                    itemsContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== `items-${tabId}`);
                        if (content.id === `items-${tabId}`) {
                            content.classList.add('glass-fade-in');
                        }
                    });
                });
            });

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Animación de cristal
                    button.classList.add('glass-press');
                    setTimeout(() => button.classList.remove('glass-press'), 200);
                    // Retroalimentación háptica
                    if (navigator.vibrate) {
                        navigator.vibrate(30);
                    }
                    
                    const tabId = button.dataset.tab;

                    tabButtons.forEach(btn => {
                        btn.classList.remove('text-amber-400', 'active');
                        btn.classList.add('text-zinc-400');
                    });
                    button.classList.add('text-amber-400', 'active');
                    button.classList.remove('text-zinc-400');

                    tabContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== `tab-${tabId}`);
                        if (content.id === `tab-${tabId}`) {
                            content.classList.add('glass-fade-in');
                        }
                    });
                });
            });

            // --- SISTEMA DE BÚSQUEDA ---
            
            // Variables para búsqueda
            let searchTimeout = null;
            let currentSearchResults = [];
            
            // Función de búsqueda general
            function performGeneralSearch(query) {
                if (!query || query.trim().length < 2) {
                    hideGeneralSearchResults();
                    return;
                }
                
                const searchTerm = query.toLowerCase().trim();
                const results = [];
                
                // Buscar en jefes
                if (gameData.bosses) {
                    gameData.bosses.forEach(boss => {
                        if ((boss.name && boss.name.toLowerCase().includes(searchTerm)) || 
                            (boss.description && boss.description.toLowerCase().includes(searchTerm)) ||
                            (boss.region && boss.region.toLowerCase().includes(searchTerm)) ||
                            (boss.location && boss.location.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'jefe',
                                data: boss,
                                match: boss.name
                            });
                        }
                    });
                }
                
                // Buscar en armas
                if (gameData.weapons) {
                    gameData.weapons.forEach(weapon => {
                        if ((weapon.name && weapon.name.toLowerCase().includes(searchTerm)) || 
                            (weapon.description && weapon.description.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'arma',
                                data: weapon,
                                match: weapon.name
                            });
                        }
                    });
                }
                
                // Buscar en objetos generales
                if (gameData.items) {
                    gameData.items.forEach(item => {
                        if ((item.name && item.name.toLowerCase().includes(searchTerm)) || 
                            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                            (item.location && item.location.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'objeto',
                                data: item,
                                match: item.name
                            });
                        }
                    });
                }
                
                // Buscar en talismanes
                if (gameData.talismans) {
                    gameData.talismans.forEach(item => {
                        if ((item.name && item.name.toLowerCase().includes(searchTerm)) || 
                            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                            (item.effect && item.effect.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'objeto',
                                data: item,
                                match: item.name
                            });
                        }
                    });
                }
                
                // Buscar en armaduras
                if (gameData.armors) {
                    gameData.armors.forEach(item => {
                        if ((item.name && item.name.toLowerCase().includes(searchTerm)) || 
                            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                            (item.location && item.location.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'objeto',
                                data: item,
                                match: item.name
                            });
                        }
                    });
                }
                
                // Buscar en escudos
                if (gameData.shields) {
                    gameData.shields.forEach(item => {
                        if ((item.name && item.name.toLowerCase().includes(searchTerm)) || 
                            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                            (item.location && item.location.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'objeto',
                                data: item,
                                match: item.name
                            });
                        }
                    });
                }
                
                // Buscar en municiones
                if (gameData.ammos) {
                    gameData.ammos.forEach(item => {
                        if ((item.name && item.name.toLowerCase().includes(searchTerm)) || 
                            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                            (item.location && item.location.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'objeto',
                                data: item,
                                match: item.name
                            });
                        }
                    });
                }
                
                // Buscar en cenizas de guerra
                if (gameData.ashes) {
                    gameData.ashes.forEach(item => {
                        if ((item.name && item.name.toLowerCase().includes(searchTerm)) || 
                            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                            (item.location && item.location.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'objeto',
                                data: item,
                                match: item.name
                            });
                        }
                    });
                }
                
                // Buscar en espíritus
                if (gameData.spirits) {
                    gameData.spirits.forEach(item => {
                        if ((item.name && item.name.toLowerCase().includes(searchTerm)) || 
                            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                            (item.location && item.location.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'objeto',
                                data: item,
                                match: item.name
                            });
                        }
                    });
                }
                
                // Buscar en hechizos
                if (gameData.sorceries) {
                    gameData.sorceries.forEach(item => {
                        if ((item.name && item.name.toLowerCase().includes(searchTerm)) || 
                            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                            (item.location && item.location.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'objeto',
                                data: item,
                                match: item.name
                            });
                        }
                    });
                }
                
                // Buscar en encantamientos
                if (gameData.incantations) {
                    gameData.incantations.forEach(item => {
                        if ((item.name && item.name.toLowerCase().includes(searchTerm)) || 
                            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                            (item.location && item.location.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'objeto',
                                data: item,
                                match: item.name
                            });
                        }
                    });
                }
                
                // Buscar en ubicaciones
                if (gameData.zones) {
                    Object.values(gameData.zones).forEach(zone => {
                        if ((zone.name && zone.name.toLowerCase().includes(searchTerm)) || 
                            (zone.description && zone.description.toLowerCase().includes(searchTerm))) {
                            results.push({
                                type: 'ubicación',
                                data: zone,
                                match: zone.name
                            });
                        }
                    });
                }
                
                currentSearchResults = results.slice(0, 10); // Limitar a 10 resultados
                displayGeneralSearchResults();
            }
            
            // Mostrar resultados de búsqueda general
            function displayGeneralSearchResults() {
                const resultsContainer = document.getElementById('search-results');
                const topResultsContainer = document.getElementById('top-search-results');
                
                // Mostrar en contenedor principal si existe
                if (resultsContainer) {
                    displayResultsInContainer(resultsContainer);
                }
                
                // Mostrar en contenedor de barra superior si existe
                if (topResultsContainer) {
                    displayResultsInContainer(topResultsContainer);
                }
            }

            function displayResultsInContainer(container) {
                if (!container) return;
                
                if (currentSearchResults.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-4">
                            <p class="text-zinc-400">No se encontraron resultados</p>
                        </div>
                    `;
                } else {
                    let html = '<div class="space-y-2">';
                    currentSearchResults.forEach(result => {
                        const typeIcon = getTypeIcon(result.type);
                        const typeColor = getTypeColor(result.type);
                        
                        html += `
                            <div class="glass-card p-3 cursor-pointer hover:bg-zinc-700/30 transition-colors" 
                                 onclick="handleSearchResultClick('${result.type}', '${result.data.id}')">
                                <div class="flex items-center space-x-3">
                                    <div class="flex-shrink-0">
                                        <span class="text-2xl">${typeIcon}</span>
                                    </div>
                                    <div class="flex-grow">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-white font-semibold">${result.match}</span>
                                            <span class="text-xs px-2 py-1 rounded-full ${typeColor}">${result.type}</span>
                                        </div>
                                        <p class="text-zinc-400 text-sm mt-1">${result.data.description || result.data.region || ''}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    container.innerHTML = html;
                }
                
                container.classList.remove('hidden');
            }
            
            // Ocultar resultados de búsqueda general
            function hideGeneralSearchResults() {
                const resultsContainer = document.getElementById('search-results');
                const topResultsContainer = document.getElementById('top-search-results');
                
                if (resultsContainer) {
                    resultsContainer.classList.add('hidden');
                }
                
                if (topResultsContainer) {
                    topResultsContainer.classList.add('hidden');
                }
            }
            
            // Funciones auxiliares para iconos y colores
            function getTypeIcon(type) {
                const icons = {
                    'jefe': '👹',
                    'arma': '⚔️',
                    'objeto': '📦',
                    'ubicación': '🗺️'
                };
                return icons[type] || '❓';
            }
            
            function getTypeColor(type) {
                const colors = {
                    'jefe': 'bg-red-500/20 text-red-400',
                    'arma': 'bg-blue-500/20 text-blue-400',
                    'objeto': 'bg-green-500/20 text-green-400',
                    'ubicación': 'bg-purple-500/20 text-purple-400'
                };
                return colors[type] || 'bg-gray-500/20 text-gray-400';
            }
            
            // Función para manejar clics en resultados de búsqueda
            window.toggleLegendarioItem = function(itemId) {
                toggleLegendarioItem(itemId);
            };

            window.handleSearchResultClick = function(type, id) {
                hideGeneralSearchResults();
                
                // Limpiar campos de búsqueda si existen
                const generalSearch = document.getElementById('general-search');
                const topSearchInput = document.getElementById('top-search-input');
                
                if (generalSearch) {
                    generalSearch.value = '';
                }
                if (topSearchInput) {
                    topSearchInput.value = '';
                }
                
                // Cerrar búsqueda expandida si está abierta
                hideSearchExpanded();
                
                if (type === 'jefe') {
                    // Mostrar detalle del jefe directamente
                    const boss = gameData.bosses.find(b => b.id === id);
                    if (boss) {
                        // Buscar la zona del jefe para el contexto de regreso
                        const zone = Object.values(gameData.zones).find(z => 
                            z.jefes && z.jefes.includes(id)
                        );
                        const fromZoneId = zone ? zone.id : null;
                        showBossDetail(id, fromZoneId);
                    }
                } else if (type === 'arma') {
                    // Mostrar detalle del arma directamente
                    showWeaponDetail(id);
                } else if (type === 'objeto') {
                    // Determinar la categoría del objeto y mostrar su detalle
                    let category = 'items'; // categoría por defecto
                    
                    // Buscar en qué categoría está el objeto
                    if (gameData.talismans && gameData.talismans.find(item => item.id === id)) {
                        category = 'talismans';
                    } else if (gameData.armors && gameData.armors.find(item => item.id === id)) {
                        category = 'armors';
                    } else if (gameData.shields && gameData.shields.find(item => item.id === id)) {
                        category = 'shields';
                    } else if (gameData.ammos && gameData.ammos.find(item => item.id === id)) {
                        category = 'ammos';
                    } else if (gameData.ashes && gameData.ashes.find(item => item.id === id)) {
                        category = 'ashes';
                    } else if (gameData.spirits && gameData.spirits.find(item => item.id === id)) {
                        category = 'spirits';
                    } else if (gameData.sorceries && gameData.sorceries.find(item => item.id === id)) {
                        category = 'sorceries';
                    } else if (gameData.incantations && gameData.incantations.find(item => item.id === id)) {
                        category = 'incantations';
                    }
                    
                    showItemDetail(id, category);
                } else if (type === 'ubicación') {
                    // Navegar a la zona específica
                    showZoneDetail(id);
                }
            };
            
            // Inicializar eventos de búsqueda
            function initializeSearchEvents() {
                // Búsqueda general (si existe)
                const generalSearch = document.getElementById('general-search');
                if (generalSearch) {
                    generalSearch.addEventListener('input', (e) => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            performGeneralSearch(e.target.value);
                        }, 300);
                    });
                    
                    // Ocultar resultados al hacer clic fuera
                    document.addEventListener('click', (e) => {
                        if (!generalSearch.contains(e.target) && !document.getElementById('search-results').contains(e.target)) {
                            hideGeneralSearchResults();
                        }
                    });
                }
                

            }

            // --- EFECTO PARALLAX ---
            function initParallax() {
                let ticking = false;
                
                function updateParallax() {
                    const scrolled = window.pageYOffset;
                    const parallaxElements = document.querySelectorAll('.parallax-bg');
                    
                    parallaxElements.forEach(element => {
                        const speed = 0.5;
                        element.style.transform = `translateY(${scrolled * speed}px)`;
                    });
                    
                    ticking = false;
                }
                
                function requestTick() {
                    if (!ticking) {
                        requestAnimationFrame(updateParallax);
                        ticking = true;
                    }
                }
                
                window.addEventListener('scroll', requestTick);
            }

            // --- TRANSICIONES DE PANTALLA ---
            function addScreenTransitions() {
                const screens = document.querySelectorAll('main');
                
                screens.forEach(screen => {
                    screen.style.transition = 'opacity 0.4s ease-in-out, transform 0.4s ease-in-out';
                });
            }

            // Iniciar la carga de datos
            initializeApp();
            
            // Inicializar efectos adicionales
            initParallax();
            addScreenTransitions();
            
            // Inicializar sistema de búsqueda
            initializeSearchEvents();
        });
        </script>
        
        <!-- Script para el manejo de la PWA -->
        <script src="js/app.js"></script>
    </body>
</html>
